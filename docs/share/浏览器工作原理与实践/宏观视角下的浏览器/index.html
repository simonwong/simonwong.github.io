<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.13">
<title data-react-helmet="true">宏观视角下的浏览器 | 王思杰的技术笔记</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://simonwong.github.io//docs/share/浏览器工作原理与实践/宏观视角下的浏览器"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="宏观视角下的浏览器 | 王思杰的技术笔记"><meta data-react-helmet="true" name="description" content="Chrome架构一个页面4个进程"><meta data-react-helmet="true" property="og:description" content="Chrome架构一个页面4个进程"><link data-react-helmet="true" rel="icon" href="/img/logo.png"><link data-react-helmet="true" rel="canonical" href="https://simonwong.github.io//docs/share/浏览器工作原理与实践/宏观视角下的浏览器"><link data-react-helmet="true" rel="alternate" href="https://simonwong.github.io//docs/share/浏览器工作原理与实践/宏观视角下的浏览器" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://simonwong.github.io//docs/share/浏览器工作原理与实践/宏观视角下的浏览器" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.a4257b32.css">
<link rel="preload" href="/assets/js/runtime~main.1b8f8963.js" as="script">
<link rel="preload" href="/assets/js/main.f0c4fd75.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_39ap">Skip to main content</a></div><nav class="navbar navbar--fixed-top navbarHideable_s2Ra"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.png" alt="logo" class="themedImage_jyj5 themedImage--light_bXtN"><img src="/img/logo.png" alt="logo" class="themedImage_jyj5 themedImage--dark_TfOY"></div><b class="navbar__title">王思杰的技术笔记</b></a><a class="navbar__item navbar__link" href="/docs/note">日常笔记</a><a class="navbar__item navbar__link" href="/docs/advanced">前端进阶</a><a class="navbar__item navbar__link" href="/docs/backend">后端</a><a class="navbar__item navbar__link" href="/docs/services">服务器</a><a class="navbar__item navbar__link" href="/docs/computerbasic">计算机基础</a><a class="navbar__item navbar__link" href="/docs/tools">工具</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/simonwong" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link" aria-label="GitHub repository"></a><div class="toggle_QhN1 toggle_zXcT toggleDisabled_Wt74"><div class="toggleTrack_Xi3n" role="button" tabindex="-1"><div class="toggleTrackCheck_RyGj"><span class="toggleIcon_wBYz">🌜</span></div><div class="toggleTrackX_2j0c"><span class="toggleIcon_wBYz">🌞</span></div><div class="toggleTrackThumb_tvHQ"></div></div><input type="checkbox" class="toggleScreenReader_T6TL" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_u9uu"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_Cw-v" type="button"></button><aside class="docSidebarContainer_RHhy"><div class="sidebar_j3g2 sidebarWithHideableNavbar_5sqw"><a tabindex="-1" class="sidebarLogo_2Rmf" href="/"><img src="/img/logo.png" alt="logo" class="themedImage_jyj5 themedImage--light_bXtN"><img src="/img/logo.png" alt="logo" class="themedImage_jyj5 themedImage--dark_TfOY"><b>王思杰的技术笔记</b></a><nav class="menu thin-scrollbar menu_uPQG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/share">目录</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_4kBW" href="/docs/share/重学前端/">重学前端</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active hasHref_4kBW" href="/docs/share/浏览器工作原理与实践/宏观视角下的浏览器">浏览器工作原理与实践</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/share/浏览器工作原理与实践/宏观视角下的浏览器">宏观视角下的浏览器</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/share/浏览器工作原理与实践/浏览器中JS的执行机制">浏览器中JS的执行机制</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/share/浏览器工作原理与实践/v8工作原理">V8工作原理</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/share/浏览器工作原理与实践/浏览器的循环系统">浏览器的循环系统</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/share/浏览器工作原理与实践/浏览器中的页面">浏览器中的页面</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/share/浏览器工作原理与实践/浏览器中的网络">浏览器中的网络</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/share/浏览器工作原理与实践/浏览器安全">浏览器安全</a></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/share/TypeScript、Rollup搭建工具库">TypeScript、Rollup 搭建工具库</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/share/从webpack打包看前端模块化">从 webpack 打包看前端模块化</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/share/ReactFiber架构浅析">React Fiber 架构</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/share/React性能优化方案">React性能优化</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/share/TCP协议">TCP协议</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/share/函数式编程之柯里化">函数式编程之柯里化</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/share/多版本包依赖问题探讨">npm多版本包依赖问题探讨</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/share/常见的函数组合">常见的函数组合</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/share/算法分享递归到树到动态规划">算法分享</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/share/纯函数">纯函数</a></li></ul></nav><button type="button" title="Collapse sidebar" aria-label="Collapse sidebar" class="button button--secondary button--outline collapseSidebarButton_JpSp"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_zW+u"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></aside><main class="docMainContainer_p5AD"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_fyW7"><div class="docItemContainer_bqr5"><article><div class="tocCollapsible_Wdd4 theme-doc-toc-mobile tocMobile_UBri"><button type="button" class="clean-btn tocCollapsibleButton_5qdN">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>宏观视角下的浏览器</h1></header><h2 class="anchor anchorWithHideOnScrollNavbar_Vm8l" id="chrome架构一个页面4个进程">Chrome架构一个页面4个进程<a aria-hidden="true" class="hash-link" href="#chrome架构一个页面4个进程" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithHideOnScrollNavbar_Vm8l" id="并行处理">并行处理<a aria-hidden="true" class="hash-link" href="#并行处理" title="Direct link to heading">​</a></h3><p>第一步，使用三个线程分别执行三个任务</p><p>第二部，显示结果</p><h3 class="anchor anchorWithHideOnScrollNavbar_Vm8l" id="线程-进程">线程 进程<a aria-hidden="true" class="hash-link" href="#线程-进程" title="Direct link to heading">​</a></h3><p><img src="http://file.wangsijie.top/blog/20210604095019.png"></p><p>线程依附于进程，而进程中使用多线程并行处理能提升运算效率。</p><p><strong>4个特点</strong></p><ol><li>进程中的任意线程执行出错会导致整个进程崩溃</li><li>线程之间共享进程中的数据</li><li>一个进程关闭后，操作系统会回收进程所占内存</li><li>进程之间内容隔离</li></ol><h3 class="anchor anchorWithHideOnScrollNavbar_Vm8l" id="目前多进程架构">目前多进程架构<a aria-hidden="true" class="hash-link" href="#目前多进程架构" title="Direct link to heading">​</a></h3><p><img src="http://file.wangsijie.top/blog/20210604095658.png"></p><ul><li>浏览器进程。负责界面显示、用户交互、子进程管理。提供存储等功能</li><li>渲染进程。核心任务是将 html 、css、js 转换为用户可以交互的网页，Blink 和 js 引擎 v8 都运行在该进程中。Chrome 会为每个 Tab 创建一个渲染进程（同站点，即相同协议和根域名，会使用同一个渲染进程），并运行在沙箱模式下</li><li>GPU 进程。刚开始没有这个进程，随后需要GPU绘制的需求成为普遍需求，而引进</li><li>网络进程。主要负责页面的网络资源加载，直至最近才独立出来</li><li>插件进程。负责插件的运行，因插件易崩溃，所以隔离出来，避免影响浏览器和页面</li></ul><h2 class="anchor anchorWithHideOnScrollNavbar_Vm8l" id="浏览器缓存和http过程">浏览器缓存和http过程<a aria-hidden="true" class="hash-link" href="#浏览器缓存和http过程" title="Direct link to heading">​</a></h2><p><img src="http://file.wangsijie.top/blog/20210604154550.png"></p><p><img src="http://file.wangsijie.top/blog/20210604154559.png"></p><h2 class="anchor anchorWithHideOnScrollNavbar_Vm8l" id="从输入url到页面展示中间发生了什么">从输入URL到页面展示，中间发生了什么<a aria-hidden="true" class="hash-link" href="#从输入url到页面展示中间发生了什么" title="Direct link to heading">​</a></h2><p>自说自话：浏览器主进程接收到 URL 地址后，交给网络进程请求，将相应的数据传递给渲染引擎，然后渲染引擎会解析 css、html，渲染成最终的页面。</p><ul><li>首先，浏览器进程接收到用户输入的URL请求，浏览器进程便将该URL转发给网络进程。</li><li>然后，在网络进程中发起真正的URL请求。</li><li>接着网络进程接收到了响应头数据，便解析响应头数据，并将数据转发给浏览器进程。</li><li>浏览器进程接收到网络进程的响应头数据之后，发送“提交导航(CommitNavigation)”消息到渲染进程；</li><li>渲染进程接收到“提交导航”的消息之后，便开始准备接收HTML数据，接收数据的方式是直接和网络进程建立数据管道；</li><li>最后渲染进程会向浏览器进程“确认提交”，这是告诉浏览器进程：“已经准备好接受和解析页面数据了”。</li><li>浏览器进程接收到渲染进程“提交文档”的消息之后，便开始移除之前旧的文档，然后更新浏览器进程中的页面状态。</li></ul><h2 class="anchor anchorWithHideOnScrollNavbar_Vm8l" id="渲染流程">渲染流程<a aria-hidden="true" class="hash-link" href="#渲染流程" title="Direct link to heading">​</a></h2><ol><li>渲染进程将HTML内容转换为能够读懂的<strong>DOM树</strong>结构。</li><li>渲染引擎将CSS样式表转化为浏览器可以理解的<strong>styleSheets</strong>，计算出DOM节点的样式。</li><li>创建<strong>布局树</strong>，并计算元素的布局信息。</li><li>对布局树进行分层，并生成<strong>分层树</strong>。</li><li>为每个图层生成<strong>绘制列表</strong>，并将其提交到合成线程。</li><li>合成线程将图层分成<strong>图块</strong>，并在<strong>光栅化线程池</strong>中将图块转换成位图。</li><li>合成线程发送绘制图块命令<strong>DrawQuad</strong>给浏览器进程。</li><li>浏览器进程根据DrawQuad消息<strong>生成页面</strong>，并<strong>显示</strong>到显示器上。</li></ol><p><img src="http://file.wangsijie.top/blog/20210607142620.png"></p><h3 class="anchor anchorWithHideOnScrollNavbar_Vm8l" id="重排">重排<a aria-hidden="true" class="hash-link" href="#重排" title="Direct link to heading">​</a></h3><p>更新了元素的几何信息，如改变元素的宽高。</p><p><strong>重排需要更新完整的渲染流水线，开销最大</strong></p><h3 class="anchor anchorWithHideOnScrollNavbar_Vm8l" id="重绘">重绘<a aria-hidden="true" class="hash-link" href="#重绘" title="Direct link to heading">​</a></h3><p>更新元素的绘制属性，例如背景颜色</p><p><strong>重绘省去了布局和分层阶段，所以执行效率比重排高</strong></p><h3 class="anchor anchorWithHideOnScrollNavbar_Vm8l" id="直接合成阶段">直接合成阶段<a aria-hidden="true" class="hash-link" href="#直接合成阶段" title="Direct link to heading">​</a></h3><p>更改一个既不用布局也不用绘制的属性，会避开布局绘制阶段，直接来到合成。例如 transform 属性</p><p><strong>合成能大大提升绘制效率</strong></p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/facebook/docusaurus/edit/master/website/docs/share/浏览器工作原理与实践/1.宏观视角下的浏览器.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_kTL6" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_HEBW"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/share/重学前端/engineering-practice"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">« <!-- -->工程实践</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/share/浏览器工作原理与实践/浏览器中JS的执行机制"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">浏览器中JS的执行机制<!-- --> »</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_J7gS thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#chrome架构一个页面4个进程" class="table-of-contents__link toc-highlight">Chrome架构一个页面4个进程</a><ul><li><a href="#并行处理" class="table-of-contents__link toc-highlight">并行处理</a></li><li><a href="#线程-进程" class="table-of-contents__link toc-highlight">线程 进程</a></li><li><a href="#目前多进程架构" class="table-of-contents__link toc-highlight">目前多进程架构</a></li></ul></li><li><a href="#浏览器缓存和http过程" class="table-of-contents__link toc-highlight">浏览器缓存和http过程</a></li><li><a href="#从输入url到页面展示中间发生了什么" class="table-of-contents__link toc-highlight">从输入URL到页面展示，中间发生了什么</a></li><li><a href="#渲染流程" class="table-of-contents__link toc-highlight">渲染流程</a><ul><li><a href="#重排" class="table-of-contents__link toc-highlight">重排</a></li><li><a href="#重绘" class="table-of-contents__link toc-highlight">重绘</a></li><li><a href="#直接合成阶段" class="table-of-contents__link toc-highlight">直接合成阶段</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs/note">日常笔记</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/advanced">前端进阶</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items"><li class="footer__item"><a href="https://twitter.com/wsj_simonwong" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_yE7i"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items"><li class="footer__item"><a href="https://www.wangsijie.top/" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>哎呦，你来啦<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_yE7i"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://github.com/simonwong" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_yE7i"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2019-2022 Simon Wong.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.1b8f8963.js"></script>
<script src="/assets/js/main.f0c4fd75.js"></script>
</body>
</html>