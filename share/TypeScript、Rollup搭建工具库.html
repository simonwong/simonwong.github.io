<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>TypeScript、Rollup 搭建工具库 | 王思杰的前端笔记</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="/logo.png">
    <meta name="description" content="分享日常总结，工具框架的使用以及整理">
    <meta http-equiv="cache-control" content="no-cache">
    
    <link rel="preload" href="/assets/css/0.styles.7352d3e5.css" as="style"><link rel="preload" href="/assets/js/app.b10b90d4.js" as="script"><link rel="preload" href="/assets/js/2.aba2ec75.js" as="script"><link rel="preload" href="/assets/js/80.0abc5f87.js" as="script"><link rel="preload" href="/assets/js/3.a992b9fe.js" as="script"><link rel="prefetch" href="/assets/js/10.91bf469c.js"><link rel="prefetch" href="/assets/js/100.cff3a47e.js"><link rel="prefetch" href="/assets/js/101.100801aa.js"><link rel="prefetch" href="/assets/js/102.c6dc08b2.js"><link rel="prefetch" href="/assets/js/103.6c050768.js"><link rel="prefetch" href="/assets/js/104.ac189813.js"><link rel="prefetch" href="/assets/js/105.8a76ca38.js"><link rel="prefetch" href="/assets/js/106.86d28331.js"><link rel="prefetch" href="/assets/js/107.e7eb1e6f.js"><link rel="prefetch" href="/assets/js/108.bbbac73a.js"><link rel="prefetch" href="/assets/js/109.7486ed5d.js"><link rel="prefetch" href="/assets/js/11.1f8bf62f.js"><link rel="prefetch" href="/assets/js/110.e7efee71.js"><link rel="prefetch" href="/assets/js/111.a5f5e39f.js"><link rel="prefetch" href="/assets/js/112.320c80f2.js"><link rel="prefetch" href="/assets/js/113.051bcab9.js"><link rel="prefetch" href="/assets/js/114.4cae358f.js"><link rel="prefetch" href="/assets/js/115.8d5a68e5.js"><link rel="prefetch" href="/assets/js/116.92c1b1c1.js"><link rel="prefetch" href="/assets/js/12.2c1e75e2.js"><link rel="prefetch" href="/assets/js/13.659a494d.js"><link rel="prefetch" href="/assets/js/14.e72fb477.js"><link rel="prefetch" href="/assets/js/15.f84f7b47.js"><link rel="prefetch" href="/assets/js/16.d398ce74.js"><link rel="prefetch" href="/assets/js/17.77fab2ad.js"><link rel="prefetch" href="/assets/js/18.14b96c75.js"><link rel="prefetch" href="/assets/js/19.bc97bf97.js"><link rel="prefetch" href="/assets/js/20.5f0e92f6.js"><link rel="prefetch" href="/assets/js/21.68c35422.js"><link rel="prefetch" href="/assets/js/22.b107e40e.js"><link rel="prefetch" href="/assets/js/23.23008d90.js"><link rel="prefetch" href="/assets/js/24.40f731dd.js"><link rel="prefetch" href="/assets/js/25.aaead0e9.js"><link rel="prefetch" href="/assets/js/26.1253f6b0.js"><link rel="prefetch" href="/assets/js/27.13803d3f.js"><link rel="prefetch" href="/assets/js/28.2249e21c.js"><link rel="prefetch" href="/assets/js/29.f495570c.js"><link rel="prefetch" href="/assets/js/30.a0fb088b.js"><link rel="prefetch" href="/assets/js/31.7c3476ae.js"><link rel="prefetch" href="/assets/js/32.2691283d.js"><link rel="prefetch" href="/assets/js/33.adbffdbd.js"><link rel="prefetch" href="/assets/js/34.1e39158e.js"><link rel="prefetch" href="/assets/js/35.edfc3d3e.js"><link rel="prefetch" href="/assets/js/36.80669852.js"><link rel="prefetch" href="/assets/js/37.ece2b30d.js"><link rel="prefetch" href="/assets/js/38.c645f28e.js"><link rel="prefetch" href="/assets/js/39.8f8a1b8c.js"><link rel="prefetch" href="/assets/js/4.45d09f32.js"><link rel="prefetch" href="/assets/js/40.d423e0d6.js"><link rel="prefetch" href="/assets/js/41.ace646da.js"><link rel="prefetch" href="/assets/js/42.d14b4120.js"><link rel="prefetch" href="/assets/js/43.d0b9ff26.js"><link rel="prefetch" href="/assets/js/44.5024b2e5.js"><link rel="prefetch" href="/assets/js/45.6a82c535.js"><link rel="prefetch" href="/assets/js/46.779ea6cb.js"><link rel="prefetch" href="/assets/js/47.5f7f05b0.js"><link rel="prefetch" href="/assets/js/48.a0acf725.js"><link rel="prefetch" href="/assets/js/49.b5c33505.js"><link rel="prefetch" href="/assets/js/5.f3c9e357.js"><link rel="prefetch" href="/assets/js/50.2931e2ab.js"><link rel="prefetch" href="/assets/js/51.0f5070d6.js"><link rel="prefetch" href="/assets/js/52.e69b14d5.js"><link rel="prefetch" href="/assets/js/53.a4e727ca.js"><link rel="prefetch" href="/assets/js/54.3993d045.js"><link rel="prefetch" href="/assets/js/55.215c51d5.js"><link rel="prefetch" href="/assets/js/56.6a8bb769.js"><link rel="prefetch" href="/assets/js/57.06b1273c.js"><link rel="prefetch" href="/assets/js/58.5edb4108.js"><link rel="prefetch" href="/assets/js/59.0d4aa606.js"><link rel="prefetch" href="/assets/js/6.a6c6c2e5.js"><link rel="prefetch" href="/assets/js/60.b94ee0d3.js"><link rel="prefetch" href="/assets/js/61.9536da47.js"><link rel="prefetch" href="/assets/js/62.d16d98c7.js"><link rel="prefetch" href="/assets/js/63.d7f18967.js"><link rel="prefetch" href="/assets/js/64.04912a97.js"><link rel="prefetch" href="/assets/js/65.c469e7ff.js"><link rel="prefetch" href="/assets/js/66.d912c1c1.js"><link rel="prefetch" href="/assets/js/67.e662faf6.js"><link rel="prefetch" href="/assets/js/68.584676ee.js"><link rel="prefetch" href="/assets/js/69.f9d1023f.js"><link rel="prefetch" href="/assets/js/7.937a30f1.js"><link rel="prefetch" href="/assets/js/70.892b87dd.js"><link rel="prefetch" href="/assets/js/71.32cd024e.js"><link rel="prefetch" href="/assets/js/72.b092d8d6.js"><link rel="prefetch" href="/assets/js/73.25c1d80f.js"><link rel="prefetch" href="/assets/js/74.8f9268df.js"><link rel="prefetch" href="/assets/js/75.62cf6721.js"><link rel="prefetch" href="/assets/js/76.e320ecf7.js"><link rel="prefetch" href="/assets/js/77.ad68baed.js"><link rel="prefetch" href="/assets/js/78.d8bff19d.js"><link rel="prefetch" href="/assets/js/79.e8522410.js"><link rel="prefetch" href="/assets/js/8.89804910.js"><link rel="prefetch" href="/assets/js/81.dfe2cad8.js"><link rel="prefetch" href="/assets/js/82.305b6f50.js"><link rel="prefetch" href="/assets/js/83.98f0cdfc.js"><link rel="prefetch" href="/assets/js/84.4b1ac88e.js"><link rel="prefetch" href="/assets/js/85.f7567b7b.js"><link rel="prefetch" href="/assets/js/86.637ea658.js"><link rel="prefetch" href="/assets/js/87.ad0859f7.js"><link rel="prefetch" href="/assets/js/88.188b07fc.js"><link rel="prefetch" href="/assets/js/89.32a5f1a9.js"><link rel="prefetch" href="/assets/js/9.0cd8aeb4.js"><link rel="prefetch" href="/assets/js/90.03321550.js"><link rel="prefetch" href="/assets/js/91.9355456d.js"><link rel="prefetch" href="/assets/js/92.56996d3b.js"><link rel="prefetch" href="/assets/js/93.8741417d.js"><link rel="prefetch" href="/assets/js/94.61193ccb.js"><link rel="prefetch" href="/assets/js/95.f8bc9781.js"><link rel="prefetch" href="/assets/js/96.550ed2bd.js"><link rel="prefetch" href="/assets/js/97.781c9b6b.js"><link rel="prefetch" href="/assets/js/98.3865a259.js"><link rel="prefetch" href="/assets/js/99.ea1633c6.js">
    <link rel="stylesheet" href="/assets/css/0.styles.7352d3e5.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">王思杰的前端笔记</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/note/" class="nav-link">
  日常笔记
</a></div><div class="nav-item"><a href="/advanced/" class="nav-link">
  前端进阶
</a></div><div class="nav-item"><a href="/backend/" class="nav-link">
  后端
</a></div><div class="nav-item"><a href="/services/" class="nav-link">
  服务器
</a></div><div class="nav-item"><a href="/computerbasic/" class="nav-link">
  计算机基础
</a></div><div class="nav-item"><a href="/tools/" class="nav-link">
  工具
</a></div><div class="nav-item"><a href="/share/" class="nav-link router-link-active">
  杂乱/分享
</a></div><div class="nav-item"><a href="https://github.com/simonwong" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/note/" class="nav-link">
  日常笔记
</a></div><div class="nav-item"><a href="/advanced/" class="nav-link">
  前端进阶
</a></div><div class="nav-item"><a href="/backend/" class="nav-link">
  后端
</a></div><div class="nav-item"><a href="/services/" class="nav-link">
  服务器
</a></div><div class="nav-item"><a href="/computerbasic/" class="nav-link">
  计算机基础
</a></div><div class="nav-item"><a href="/tools/" class="nav-link">
  工具
</a></div><div class="nav-item"><a href="/share/" class="nav-link router-link-active">
  杂乱/分享
</a></div><div class="nav-item"><a href="https://github.com/simonwong" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/share/" aria-current="page" class="sidebar-link">杂乱/分享</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>重学前端</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>浏览器工作原理与实践</span> <span class="arrow right"></span></p> <!----></section></li><li><a href="/share/TypeScript、Rollup搭建工具库.html" class="active sidebar-link">TypeScript、Rollup 搭建工具库</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/share/TypeScript、Rollup搭建工具库.html#前景提要" class="sidebar-link">前景提要</a></li><li class="sidebar-sub-header"><a href="/share/TypeScript、Rollup搭建工具库.html#初始化项目" class="sidebar-link">初始化项目</a></li><li class="sidebar-sub-header"><a href="/share/TypeScript、Rollup搭建工具库.html#配置-eslint" class="sidebar-link">配置 eslint</a></li><li class="sidebar-sub-header"><a href="/share/TypeScript、Rollup搭建工具库.html#配置-rollup" class="sidebar-link">配置 rollup</a></li><li class="sidebar-sub-header"><a href="/share/TypeScript、Rollup搭建工具库.html#配置-jest" class="sidebar-link">配置 jest</a></li><li class="sidebar-sub-header"><a href="/share/TypeScript、Rollup搭建工具库.html#配置-microsoft-api-extractor" class="sidebar-link">配置 @microsoft/api-extractor</a></li><li class="sidebar-sub-header"><a href="/share/TypeScript、Rollup搭建工具库.html#gulp-自动化构建" class="sidebar-link">gulp 自动化构建</a></li><li class="sidebar-sub-header"><a href="/share/TypeScript、Rollup搭建工具库.html#changelog-自动生成" class="sidebar-link">changelog 自动生成</a></li><li class="sidebar-sub-header"><a href="/share/TypeScript、Rollup搭建工具库.html#优化开发流程" class="sidebar-link">优化开发流程</a></li><li class="sidebar-sub-header"><a href="/share/TypeScript、Rollup搭建工具库.html#优化发布流程" class="sidebar-link">优化发布流程</a></li><li class="sidebar-sub-header"><a href="/share/TypeScript、Rollup搭建工具库.html#changelog-例子" class="sidebar-link">changelog 例子</a></li><li class="sidebar-sub-header"><a href="/share/TypeScript、Rollup搭建工具库.html#参考" class="sidebar-link">参考</a></li></ul></li><li><a href="/share/从webpack打包看前端模块化.html" class="sidebar-link">从 webpack 打包看前端模块化</a></li><li><a href="/share/ReactFiber架构浅析.html" class="sidebar-link">React Fiber 架构 #</a></li><li><a href="/share/React性能优化方案.html" class="sidebar-link">React性能优化 #</a></li><li><a href="/share/TCP协议.html" class="sidebar-link">TCP协议 #</a></li><li><a href="/share/函数式编程之柯里化.html" class="sidebar-link">函数式编程之柯里化 #</a></li><li><a href="/share/多版本包依赖问题探讨.html" class="sidebar-link">npm多版本包依赖问题探讨</a></li><li><a href="/share/常见的函数组合.html" class="sidebar-link">常见的函数组合</a></li><li><a href="/share/算法分享递归到树到动态规划.html" class="sidebar-link">算法分享</a></li><li><a href="/share/纯函数.html" class="sidebar-link">纯函数 #</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="typescript、rollup-搭建工具库"><a href="#typescript、rollup-搭建工具库" class="header-anchor">#</a> TypeScript、Rollup 搭建工具库</h1> <p><img src="http://file.wangsijie.top/blog/20191226183850.png" alt=""></p> <h2 id="前景提要"><a href="#前景提要" class="header-anchor">#</a> 前景提要</h2> <p>公司内总是有许多通用的工具方法、业务功能，我们可以搭建一个工具库来给各个项目使用。</p> <p>要实现的需求：🤔</p> <ul><li>支持编辑器的快速补全和提示</li> <li>自动化构建</li> <li>支持自动生成 changlog</li> <li>代码通过 lint 和测试后才能提交、发布</li></ul> <h3 id="涉及的库"><a href="#涉及的库" class="header-anchor">#</a> 涉及的库</h3> <ul><li>eslint + @typescript-eslint/parser</li> <li>rollup</li> <li>jest</li> <li>@microsoft/api-extractor</li> <li>gulp</li></ul> <h2 id="初始化项目"><a href="#初始化项目" class="header-anchor">#</a> 初始化项目</h2> <p>新建一个项目目录如 <code>fly-helper</code> , 并 <code>npm init</code> 初始化项目。</p> <h3 id="安装-typescript"><a href="#安装-typescript" class="header-anchor">#</a> 安装 <a href="https://www.tslang.cn/docs/home.html" target="_blank" rel="noopener noreferrer">TypeScript<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></h3> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">yarn</span> <span class="token function">add</span> -D typescript
</code></pre></div><p>创建 <code>src</code> 目录，入口文件，以及 ts 的配置文件</p> <div class="language- extra-class"><pre class="language-text"><code>fly-helper
 |
 |- src
 	 |- index.ts
 |- tsconfig.json
</code></pre></div><h3 id="配置-tsconfig-json"><a href="#配置-tsconfig-json" class="header-anchor">#</a> 配置 tsconfig.json</h3> <div class="language-json extra-class"><pre class="language-json"><code><span class="token comment">/*  tsconfig.json */</span>
<span class="token punctuation">{</span>
  <span class="token property">&quot;compilerOptions&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token comment">/* 基础配置 */</span>
    <span class="token property">&quot;target&quot;</span><span class="token operator">:</span> <span class="token string">&quot;esnext&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;lib&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token string">&quot;dom&quot;</span><span class="token punctuation">,</span>
      <span class="token string">&quot;esnext&quot;</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token property">&quot;removeComments&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    <span class="token property">&quot;declaration&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token property">&quot;sourceMap&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>

    <span class="token comment">/* 强类型检查配置 */</span>
    <span class="token property">&quot;strict&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token property">&quot;noImplicitAny&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>

    <span class="token comment">/* 模块分析配置 */</span>
    <span class="token property">&quot;baseUrl&quot;</span><span class="token operator">:</span> <span class="token string">&quot;.&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;outDir&quot;</span><span class="token operator">:</span> <span class="token string">&quot;./lib&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;esModuleInterop&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token property">&quot;moduleResolution&quot;</span><span class="token operator">:</span> <span class="token string">&quot;node&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;resolveJsonModule&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">&quot;include&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token string">&quot;src&quot;</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="参考-commit"><a href="#参考-commit" class="header-anchor">#</a> 参考 commit</h3> <p><a href="https://github.com/simonwong/fly-helper/commit/1892d46aa6131806f720581737af60ea0c2fd4c2" target="_blank" rel="noopener noreferrer">1892d4<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>Ps：commit 中还增加了 .editorconfig  ，来约束同学们的代码格式</p> <h2 id="配置-eslint"><a href="#配置-eslint" class="header-anchor">#</a> 配置 eslint</h2> <p>TypeScirpt 已经全面采用 ESLint 作为代码检查 <a href="https://eslint.org/blog/2019/01/future-typescript-eslint" target="_blank" rel="noopener noreferrer">The future of TypeScript on ESLint<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>并且提供了 TypeScript 文件的解析器 <a href="https://github.com/typescript-eslint/typescript-eslint/tree/master/packages/parser" target="_blank" rel="noopener noreferrer">@typescript-eslint/parser<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 和配置选项 <a href="https://github.com/typescript-eslint/typescript-eslint/tree/master/packages/eslint-plugin" target="_blank" rel="noopener noreferrer">@typescript-eslint/eslint-plugin<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h3 id="安装"><a href="#安装" class="header-anchor">#</a> 安装</h3> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">yarn</span> <span class="token function">add</span> -D eslint @typescript-eslint/parser @typescript-eslint/eslint-plugin 
</code></pre></div><h3 id="目录结构"><a href="#目录结构" class="header-anchor">#</a> 目录结构</h3> <div class="language- extra-class"><pre class="language-text"><code>fly-helper
 |- .eslintignore
 |- .eslintrc.js
 |- tsconfig.eslint.json
</code></pre></div><h3 id="ps"><a href="#ps" class="header-anchor">#</a> Ps</h3> <p>tsconfig.eslint.json 我们根目录中增加了一个 tsconfig 文件，它将用于 <code>eslintrc.parserOptions.project</code> ，由于该配置要求 incude 每个 ts、js 文件。而我们仅需要打包 src 目录下的代码，所以增加了该配置文件。</p> <p>如果 <code>eslintrc.parserOptions.project</code> 配置为 tsconfig.json 。src 文件以外的 ts、js 文件都会报错。</p> <div class="language- extra-class"><pre class="language-text"><code>Parsing error: &quot;parserOptions.project&quot; has been set for @typescript-eslint/parser.
The file does not match your project config: config.ts.
The file must be included in at least one of the projects provided.eslint
</code></pre></div><p>虽然可以配置 <code>eslintrc.parserOptions.createDefaultProgram</code> 但会造成巨大的性能损耗。</p> <p><a href="https://github.com/typescript-eslint/typescript-eslint/issues/967" target="_blank" rel="noopener noreferrer">issus: Parsing error: &quot;parserOptions.project&quot;...<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h3 id="配置-tsconfig-eslint-json"><a href="#配置-tsconfig-eslint-json" class="header-anchor">#</a> 配置 tsconfig.eslint.json</h3> <div class="language-json extra-class"><pre class="language-json"><code><span class="token comment">/* tsconfig.eslint.json */</span>
<span class="token punctuation">{</span>
  <span class="token property">&quot;compilerOptions&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;baseUrl&quot;</span><span class="token operator">:</span> <span class="token string">&quot;.&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;resolveJsonModule&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">&quot;include&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token string">&quot;**/*.ts&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;**/*.js&quot;</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="配置-eslintrc-js"><a href="#配置-eslintrc-js" class="header-anchor">#</a> 配置 .eslintrc.js</h3> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// .eslintrc.js</span>
<span class="token keyword">const</span> eslintrc <span class="token operator">=</span> <span class="token punctuation">{</span>
    parser<span class="token operator">:</span> <span class="token string">'@typescript-eslint/parser'</span><span class="token punctuation">,</span> <span class="token comment">// 使用 ts 解析器</span>
    <span class="token keyword">extends</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token string">'eslint:recommended'</span><span class="token punctuation">,</span> <span class="token comment">// eslint 推荐规则</span>
        <span class="token string">'plugin:@typescript-eslint/recommended'</span><span class="token punctuation">,</span> <span class="token comment">// ts 推荐规则</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token string">'@typescript-eslint'</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    env<span class="token operator">:</span> <span class="token punctuation">{</span>
        browser<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        node<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        es6<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    parserOptions<span class="token operator">:</span> <span class="token punctuation">{</span>
        project<span class="token operator">:</span> <span class="token string">'./tsconfig.eslint.json'</span><span class="token punctuation">,</span>
        ecmaVersion<span class="token operator">:</span> <span class="token number">2019</span><span class="token punctuation">,</span>
        sourceType<span class="token operator">:</span> <span class="token string">'module'</span><span class="token punctuation">,</span>
        ecmaFeatures<span class="token operator">:</span> <span class="token punctuation">{</span>
          experimentalObjectRestSpread<span class="token operator">:</span> <span class="token boolean">true</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    rules<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token comment">// 自定义</span>
<span class="token punctuation">}</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> eslintrc
</code></pre></div><h3 id="参考-commit-2"><a href="#参考-commit-2" class="header-anchor">#</a> 参考 commit</h3> <p><a href="https://github.com/simonwong/fly-helper/commit/36f63d7ae4140ed32388b5111d0f537909e7c81d" target="_blank" rel="noopener noreferrer">36f63d<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h2 id="配置-rollup"><a href="#配置-rollup" class="header-anchor">#</a> 配置 rollup</h2> <p>vue、react 等许多流行库都在使用 Rollup.js ，就不多介绍，直接看 <a href="https://www.rollupjs.com/" target="_blank" rel="noopener noreferrer">官网<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 吧🤯</p> <h3 id="安装-2"><a href="#安装-2" class="header-anchor">#</a> 安装</h3> <p>安装 rollup 以及要用到的插件</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">yarn</span> <span class="token function">add</span> -D rollup rollup-plugin-babel rollup-plugin-commonjs rollup-plugin-eslint rollup-plugin-node-resolve rollup-plugin-typescript2
</code></pre></div><p>安装 babel 相关的库</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">yarn</span> <span class="token function">add</span> -D @babel/preset-env
</code></pre></div><h3 id="目录结构-2"><a href="#目录结构-2" class="header-anchor">#</a> 目录结构</h3> <div class="language- extra-class"><pre class="language-text"><code>fly-helper
 |
 |- typings
 	 |- index.d.ts
 |- .babelrc
 |- rollup.config.ts
</code></pre></div><h3 id="配置-babelrc"><a href="#配置-babelrc" class="header-anchor">#</a> 配置 .babelrc</h3> <div class="language-json extra-class"><pre class="language-json"><code><span class="token comment">/* .babelrc */</span>
<span class="token punctuation">{</span>
  <span class="token property">&quot;presets&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">[</span>
      <span class="token string">&quot;@babel/preset-env&quot;</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token comment">/* Babel 会在 Rollup 有机会做处理之前，将我们的模块转成 CommonJS，导致 Rollup 的一些处理失败 */</span>
        <span class="token property">&quot;modules&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="配置-rollup-config-ts"><a href="#配置-rollup-config-ts" class="header-anchor">#</a> 配置 rollup.config.ts</h3> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token keyword">import</span> path <span class="token keyword">from</span> <span class="token string">'path'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> RollupOptions <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'rollup'</span>
<span class="token keyword">import</span> rollupTypescript <span class="token keyword">from</span> <span class="token string">'rollup-plugin-typescript2'</span>
<span class="token keyword">import</span> babel <span class="token keyword">from</span> <span class="token string">'rollup-plugin-babel'</span>
<span class="token keyword">import</span> resolve <span class="token keyword">from</span> <span class="token string">'rollup-plugin-node-resolve'</span>
<span class="token keyword">import</span> commonjs <span class="token keyword">from</span> <span class="token string">'rollup-plugin-commonjs'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> eslint <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'rollup-plugin-eslint'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> <span class="token constant">DEFAULT_EXTENSIONS</span> <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@babel/core'</span>

<span class="token keyword">import</span> pkg <span class="token keyword">from</span> <span class="token string">'./package.json'</span>

<span class="token keyword">const</span> paths <span class="token operator">=</span> <span class="token punctuation">{</span>
  input<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'/src/index.ts'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  output<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'/lib'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token comment">// rollup 配置项</span>
<span class="token keyword">const</span> rollupConfig<span class="token operator">:</span> RollupOptions <span class="token operator">=</span> <span class="token punctuation">{</span>
  input<span class="token operator">:</span> paths<span class="token punctuation">.</span>input<span class="token punctuation">,</span>
  output<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token comment">// 输出 commonjs 规范的代码</span>
    <span class="token punctuation">{</span>
      file<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>paths<span class="token punctuation">.</span>output<span class="token punctuation">,</span> <span class="token string">'index.js'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      format<span class="token operator">:</span> <span class="token string">'cjs'</span><span class="token punctuation">,</span>
      name<span class="token operator">:</span> pkg<span class="token punctuation">.</span>name<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token comment">// 输出 es 规范的代码</span>
    <span class="token punctuation">{</span>
      file<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>paths<span class="token punctuation">.</span>output<span class="token punctuation">,</span> <span class="token string">'index.esm.js'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      format<span class="token operator">:</span> <span class="token string">'es'</span><span class="token punctuation">,</span>
      name<span class="token operator">:</span> pkg<span class="token punctuation">.</span>name<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token comment">// external: ['lodash'], // 指出应将哪些模块视为外部模块，如 Peer dependencies 中的依赖</span>
  <span class="token comment">// plugins 需要注意引用顺序</span>
  plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token comment">// 验证导入的文件</span>
    <span class="token function">eslint</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      throwOnError<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// lint 结果有错误将会抛出异常</span>
      throwOnWarning<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      include<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'src/**/*.ts'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      exclude<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'node_modules/**'</span><span class="token punctuation">,</span> <span class="token string">'lib/**'</span><span class="token punctuation">,</span> <span class="token string">'*.js'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>

    <span class="token comment">// 使得 rollup 支持 commonjs 规范，识别 commonjs 规范的依赖</span>
    <span class="token function">commonjs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>

    <span class="token comment">// 配合 commnjs 解析第三方模块</span>
    <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token comment">// 将自定义选项传递给解析插件</span>
      customResolveOptions<span class="token operator">:</span> <span class="token punctuation">{</span>
        moduleDirectory<span class="token operator">:</span> <span class="token string">'node_modules'</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">rollupTypescript</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">babel</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      runtimeHelpers<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      <span class="token comment">// 只转换源代码，不运行外部依赖</span>
      exclude<span class="token operator">:</span> <span class="token string">'node_modules/**'</span><span class="token punctuation">,</span>
      <span class="token comment">// babel 默认不支持 ts 需要手动添加</span>
      extensions<span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token operator">...</span><span class="token constant">DEFAULT_EXTENSIONS</span><span class="token punctuation">,</span>
        <span class="token string">'.ts'</span><span class="token punctuation">,</span>
      <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> rollupConfig
</code></pre></div><p>一些注意事项：</p> <ul><li>plugins 必须有顺序的使用</li> <li>external 来设置三方库为外部模块，否则也会被打包进去，变得非常大哦</li></ul> <h3 id="配置声明文件"><a href="#配置声明文件" class="header-anchor">#</a> 配置声明文件</h3> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token keyword">declare</span> <span class="token keyword">module</span> <span class="token string">'rollup-plugin-babel'</span>
<span class="token keyword">declare</span> <span class="token keyword">module</span> <span class="token string">'rollup-plugin-eslint'</span>
</code></pre></div><p>由于部分插件还没有 @types 库，所以我们手动添加声明文件</p> <h3 id="试一下"><a href="#试一下" class="header-anchor">#</a> 试一下</h3> <p>我们在 index.ts 文件下，随意加入一个方法</p> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">myFirstFunc</span> <span class="token punctuation">(</span>str<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">hello </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>str<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span>
<span class="token punctuation">}</span>
</code></pre></div><p>由于使用了 <code>RollupOptions</code> 接口，直接执行会报错。我们要注释掉第2行<code>import { RollupOptions } from 'rollup'</code>，和第17行 <code>const rollupConfig</code> 后面的 <code>: RollupOptions</code>。</p> <p>然后执行 <code>npx rollup --c rollup.config.ts</code></p> <p>就生成了 index.js 和 index.esm.js 文件。分别对应着 commonjs 规范和 es 规范的文件。rollup 可是大力推行 es 规范啊，然后我们很多三方库都仍旧使用 commonjs 规范，为了兼容，我们两种规范都生成。</p> <p>由于使用了 ts ，可以很方便的实现快速补全的需求，按照上面的例子，项目中使用这个包后，vscode 上输入就会有如下效果</p> <p><img src="http://file.wangsijie.top/blog/20191226114541.png" alt=""></p> <h3 id="参考-commit-3"><a href="#参考-commit-3" class="header-anchor">#</a> 参考 commit</h3> <p><a href="https://github.com/simonwong/fly-helper/commit/0aab814f129de73ef12b1652c43e04139000a2db" target="_blank" rel="noopener noreferrer">0aab81<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h2 id="配置-jest"><a href="#配置-jest" class="header-anchor">#</a> 配置 jest</h2> <p>工具库当然要写测试啦，快开始吧</p> <h3 id="安装-3"><a href="#安装-3" class="header-anchor">#</a> 安装</h3> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">yarn</span> <span class="token function">add</span> -D @types/jest eslint-plugin-jest jest ts-jest
</code></pre></div><h3 id="目录结构-3"><a href="#目录结构-3" class="header-anchor">#</a> 目录结构</h3> <div class="language- extra-class"><pre class="language-text"><code>fly-helper
 |- test
 	|- index.test.ts
 |- jest.config.js
</code></pre></div><h3 id="配置-jest-config-js"><a href="#配置-jest-config-js" class="header-anchor">#</a> 配置 jest.config.js</h3> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// jest.config.js</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  preset<span class="token operator">:</span> <span class="token string">'ts-jest'</span><span class="token punctuation">,</span>
  testEnvironment<span class="token operator">:</span> <span class="token string">'node'</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="动手写个-test-吧"><a href="#动手写个-test-吧" class="header-anchor">#</a> 动手写个 test 吧</h3> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token comment">// index.test.ts</span>

<span class="token keyword">import</span> assert <span class="token keyword">from</span> <span class="token string">'assert'</span>
<span class="token keyword">import</span> myFirstFunc <span class="token keyword">from</span> <span class="token string">'../src'</span>

<span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">'validate:'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">/**
   * myFirstFunc
   */</span>
  <span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">'myFirstFunc'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">test</span><span class="token punctuation">(</span><span class="token string">' return hello rollup '</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      assert<span class="token punctuation">.</span><span class="token function">strictEqual</span><span class="token punctuation">(</span><span class="token function">myFirstFunc</span><span class="token punctuation">(</span><span class="token string">'rollup'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'hello rollup'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="再配置-eslint"><a href="#再配置-eslint" class="header-anchor">#</a> 再配置 eslint</h3> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> eslintrc <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  <span class="token keyword">extends</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token comment">// ...</span>
    <span class="token string">'plugin:jest/recommended'</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token comment">// ...</span>
    <span class="token string">'jest'</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="增加-package-json-scripts"><a href="#增加-package-json-scripts" class="header-anchor">#</a> 增加 package.json scripts</h3> <div class="language- extra-class"><pre class="language-text"><code>&quot;test&quot;: &quot;jest --coverage --verbose -u&quot;
</code></pre></div><ul><li>coverage  输出测试覆盖率</li> <li>verbose 层次显示测试套件中每个测试的结果，会看着更加直观啦</li></ul> <h3 id="试一下-2"><a href="#试一下-2" class="header-anchor">#</a> 试一下</h3> <div class="language- extra-class"><pre class="language-text"><code>yarn test
</code></pre></div><p>是不是成功了呢😌</p> <p><img src="http://file.wangsijie.top/blog/20191226154137.png" alt=""></p> <h3 id="参考-commit-4"><a href="#参考-commit-4" class="header-anchor">#</a> 参考 commit</h3> <p><a href="https://github.com/simonwong/fly-helper/commit/9bbe5b1585ab709b8e0c1ad0ff8243b7c43b7bd7" target="_blank" rel="noopener noreferrer">9bbe5b<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h2 id="配置-microsoft-api-extractor"><a href="#配置-microsoft-api-extractor" class="header-anchor">#</a> 配置 @microsoft/api-extractor</h2> <p>当我们 src 下有多个文件时，打包后会生成多个声明文件。</p> <p>使用 @microsoft/api-extractor 这个库是为了把所有的 .d.ts 合成一个，并且，还是可以根据写的注释自动生成文档。</p> <h3 id="安装-4"><a href="#安装-4" class="header-anchor">#</a> 安装</h3> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">yarn</span> <span class="token function">add</span> -D @microsoft/api-extractor
</code></pre></div><h3 id="配置-api-extractor-json"><a href="#配置-api-extractor-json" class="header-anchor">#</a> 配置 api-extractor.json</h3> <div class="language-json extra-class"><pre class="language-json"><code><span class="token comment">/* api-extractor.json */</span>
<span class="token punctuation">{</span>
  <span class="token property">&quot;$schema&quot;</span><span class="token operator">:</span> <span class="token string">&quot;https://developer.microsoft.com/json-schemas/api-extractor/v7/api-extractor.schema.json&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;mainEntryPointFilePath&quot;</span><span class="token operator">:</span> <span class="token string">&quot;./lib/index.d.ts&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;bundledPackages&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span> <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token property">&quot;dtsRollup&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;enabled&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token property">&quot;untrimmedFilePath&quot;</span><span class="token operator">:</span> <span class="token string">&quot;./lib/index.d.ts&quot;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="增加-package-json-scripts-2"><a href="#增加-package-json-scripts-2" class="header-anchor">#</a> 增加 package.json scripts</h3> <div class="language- extra-class"><pre class="language-text"><code>&quot;api&quot;: &quot;api-extractor run&quot;,
</code></pre></div><h3 id="尝试一下"><a href="#尝试一下" class="header-anchor">#</a> 尝试一下</h3> <p>你可以尝试多写几个方法，打包后会发现有多个 .d.ts 文件，然后执行 <code>yarn api</code></p> <p>加入<a href="https://github.com/microsoft/tsdoc" target="_blank" rel="noopener noreferrer">ts doc<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 风格注释</p> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token comment">/**
 * 返回 hello 开头的字符串
 * @param str - input string
 * @returns 'hello xxx'
 * @example
 * ```ts
 * myFirstFunc('ts') =&gt; 'hello ts'
 * ```
 *
 * @beta
 * @author ziming
 */</span>
</code></pre></div><p>在使用的该方法的时候就会有提示啦</p> <p>这里我已经增加了两个方法，请看 下面的 commit</p> <p>执行后，会发现 声明都合在 index.d.ts 上啦。然后要把多余的给删除掉，后面改成自动删除它😕</p> <p>😤还有一个 temp 文件夹，咱们配置一下 gitignore 不然它提交。tsdoc-metadata.json 可以暂时不管它，可以删除掉。</p> <p>后面配置 package.json 的 typing 会自动更改存放位置</p> <h3 id="参考-commit-5"><a href="#参考-commit-5" class="header-anchor">#</a> 参考 commit</h3> <p><a href="https://github.com/simonwong/fly-helper/commit/4e4b3df2febf9f32f17e4bb06c3d734508e10b2c" target="_blank" rel="noopener noreferrer">4e4b3d<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>之后使用方法就有这样的提示，是不是会用的很方便嘞😉</p> <p><img src="http://file.wangsijie.top/blog/20191226164824.png" alt=""></p> <h2 id="gulp-自动化构建"><a href="#gulp-自动化构建" class="header-anchor">#</a> gulp 自动化构建</h2> <h3 id="安装-5"><a href="#安装-5" class="header-anchor">#</a> 安装</h3> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">yarn</span> <span class="token function">add</span> -D gulp @types/gulp fs-extra @types/fs-extra @types/node ts-node chalk
</code></pre></div><h3 id="配置-package-json"><a href="#配置-package-json" class="header-anchor">#</a> 配置 package.json</h3> <div class="language-json extra-class"><pre class="language-json"><code>  <span class="token property">&quot;main&quot;</span><span class="token operator">:</span> <span class="token string">&quot;lib/index.js&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;module&quot;</span><span class="token operator">:</span> <span class="token string">&quot;lib/index.esm.js&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;typings&quot;</span><span class="token operator">:</span> <span class="token string">&quot;lib/index.d.js&quot;</span><span class="token punctuation">,</span>

  <span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token comment">/* ... */</span>
      <span class="token property">&quot;build&quot;</span><span class="token operator">:</span> <span class="token string">&quot;gulp build&quot;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
</code></pre></div><h3 id="配置-gulpfile"><a href="#配置-gulpfile" class="header-anchor">#</a> 配置 gulpfile</h3> <p>我们思考一下构建流程🤔</p> <ol><li>删除 lib 文件</li> <li>呼叫 Rollup 打包</li> <li>api-extractor 生成统一的声明文件，然后 删除多余的声明文件</li> <li>完成</li></ol> <p>我们一步一步来</p> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token comment">// 删除 lib 文件</span>
<span class="token keyword">const</span> clearLibFile<span class="token operator">:</span> <span class="token function-variable function">TaskFunc</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span>cb<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  fse<span class="token punctuation">.</span><span class="token function">removeSync</span><span class="token punctuation">(</span>paths<span class="token punctuation">.</span>lib<span class="token punctuation">)</span>
  log<span class="token punctuation">.</span><span class="token function">progress</span><span class="token punctuation">(</span><span class="token string">'Deleted lib file'</span><span class="token punctuation">)</span>
  <span class="token function">cb</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token comment">// rollup 打包</span>
<span class="token keyword">const</span> buildByRollup<span class="token operator">:</span> <span class="token function-variable function">TaskFunc</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span>cb<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> inputOptions <span class="token operator">=</span> <span class="token punctuation">{</span>
    input<span class="token operator">:</span> rollupConfig<span class="token punctuation">.</span>input<span class="token punctuation">,</span>
    external<span class="token operator">:</span> rollupConfig<span class="token punctuation">.</span>external<span class="token punctuation">,</span>
    plugins<span class="token operator">:</span> rollupConfig<span class="token punctuation">.</span>plugins<span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">const</span> outOptions <span class="token operator">=</span> rollupConfig<span class="token punctuation">.</span>output
  <span class="token keyword">const</span> bundle <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">rollup</span><span class="token punctuation">(</span>inputOptions<span class="token punctuation">)</span>

  <span class="token comment">// 写入需要遍历输出配置</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token builtin">Array</span><span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>outOptions<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    outOptions<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span>outOption<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">await</span> bundle<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>outOption<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token function">cb</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    log<span class="token punctuation">.</span><span class="token function">progress</span><span class="token punctuation">(</span><span class="token string">'Rollup built successfully'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token comment">// api-extractor 整理 .d.ts 文件</span>
<span class="token keyword">const</span> apiExtractorGenerate<span class="token operator">:</span> <span class="token function-variable function">TaskFunc</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span>cb<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> apiExtractorJsonPath<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'./api-extractor.json'</span><span class="token punctuation">)</span>
  <span class="token comment">// 加载并解析 api-extractor.json 文件</span>
  <span class="token keyword">const</span> extractorConfig<span class="token operator">:</span> ExtractorConfig <span class="token operator">=</span> <span class="token keyword">await</span> ExtractorConfig<span class="token punctuation">.</span><span class="token function">loadFileAndPrepare</span><span class="token punctuation">(</span>apiExtractorJsonPath<span class="token punctuation">)</span>
  <span class="token comment">// 判断是否存在 index.d.ts 文件，这里必须异步先访问一边，不然后面找不到会报错</span>
  <span class="token keyword">const</span> isExist<span class="token operator">:</span> <span class="token builtin">boolean</span> <span class="token operator">=</span> <span class="token keyword">await</span> fse<span class="token punctuation">.</span><span class="token function">pathExists</span><span class="token punctuation">(</span>extractorConfig<span class="token punctuation">.</span>mainEntryPointFilePath<span class="token punctuation">)</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>isExist<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    log<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">'API Extractor not find index.d.ts'</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// 调用 API</span>
  <span class="token keyword">const</span> extractorResult<span class="token operator">:</span> ExtractorResult <span class="token operator">=</span> <span class="token keyword">await</span> Extractor<span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span>extractorConfig<span class="token punctuation">,</span> <span class="token punctuation">{</span>
    localBuild<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token comment">// 在输出中显示信息</span>
    showVerboseMessages<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>extractorResult<span class="token punctuation">.</span>succeeded<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 删除多余的 .d.ts 文件</span>
    <span class="token keyword">const</span> libFiles<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">await</span> fse<span class="token punctuation">.</span><span class="token function">readdir</span><span class="token punctuation">(</span>paths<span class="token punctuation">.</span>lib<span class="token punctuation">)</span>
    libFiles<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token keyword">async</span> file <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>file<span class="token punctuation">.</span><span class="token function">endsWith</span><span class="token punctuation">(</span><span class="token string">'.d.ts'</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>file<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span><span class="token string">'index'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">await</span> fse<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>paths<span class="token punctuation">.</span>lib<span class="token punctuation">,</span> file<span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    log<span class="token punctuation">.</span><span class="token function">progress</span><span class="token punctuation">(</span><span class="token string">'API Extractor completed successfully'</span><span class="token punctuation">)</span>
    <span class="token function">cb</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    log<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">API Extractor completed with </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>extractorResult<span class="token punctuation">.</span>errorCount<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> errors</span><span class="token template-punctuation string">`</span></span>
      <span class="token operator">+</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string"> and </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>extractorResult<span class="token punctuation">.</span>warningCount<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> warnings</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token comment">// 完成</span>
<span class="token keyword">const</span> complete<span class="token operator">:</span> <span class="token function-variable function">TaskFunc</span> <span class="token operator">=</span> <span class="token punctuation">(</span>cb<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  log<span class="token punctuation">.</span><span class="token function">progress</span><span class="token punctuation">(</span><span class="token string">'---- end ----'</span><span class="token punctuation">)</span>
  <span class="token function">cb</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>然后用一个 build 方法，将他们按顺序合起来</p> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token keyword">export</span> <span class="token keyword">const</span> build <span class="token operator">=</span> <span class="token function">series</span><span class="token punctuation">(</span>clearLibFile<span class="token punctuation">,</span> buildByRollup<span class="token punctuation">,</span> apiExtractorGenerate<span class="token punctuation">,</span> complete<span class="token punctuation">)</span>
</code></pre></div><h3 id="尝试一下-2"><a href="#尝试一下-2" class="header-anchor">#</a> 尝试一下</h3> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">yarn</span> build
</code></pre></div><p>溜去 lib 文件下瞅瞅🧐，美滋滋。</p> <h3 id="参考-commit-6"><a href="#参考-commit-6" class="header-anchor">#</a> 参考 commit</h3> <p><a href="https://github.com/simonwong/fly-helper/commit/a5370cb0c1e334d271439916648bc98586b16f05" target="_blank" rel="noopener noreferrer">a5370c<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h2 id="changelog-自动生成"><a href="#changelog-自动生成" class="header-anchor">#</a> changelog 自动生成</h2> <h3 id="安装-6"><a href="#安装-6" class="header-anchor">#</a> 安装</h3> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">yarn</span> <span class="token function">add</span> -D conventional-changelog-cli
</code></pre></div><h3 id="配置-gulpfile-2"><a href="#配置-gulpfile-2" class="header-anchor">#</a> 配置 gulpfile</h3> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token comment">// gulpfile</span>
<span class="token keyword">import</span> conventionalChangelog <span class="token keyword">from</span> <span class="token string">'conventional-changelog'</span>

<span class="token comment">// 自定义生成 changelog</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> changelog<span class="token operator">:</span> <span class="token function-variable function">TaskFunc</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span>cb<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> changelogPath<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>paths<span class="token punctuation">.</span>root<span class="token punctuation">,</span> <span class="token string">'CHANGELOG.md'</span><span class="token punctuation">)</span>
  <span class="token comment">// 对命令 conventional-changelog -p angular -i CHANGELOG.md -w -r 0</span>
  <span class="token keyword">const</span> changelogPipe <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">conventionalChangelog</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    preset<span class="token operator">:</span> <span class="token string">'angular'</span><span class="token punctuation">,</span>
    releaseCount<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  changelogPipe<span class="token punctuation">.</span><span class="token function">setEncoding</span><span class="token punctuation">(</span><span class="token string">'utf8'</span><span class="token punctuation">)</span>

  <span class="token keyword">const</span> resultArray <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'# 工具库更新日志\n\n'</span><span class="token punctuation">]</span>
  changelogPipe<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'data'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>chunk<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// 原来的 commits 路径是进入提交列表</span>
    chunk <span class="token operator">=</span> chunk<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\/commits\/</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span> <span class="token string">'/commit/'</span><span class="token punctuation">)</span>
    resultArray<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>chunk<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  changelogPipe<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'end'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">await</span> fse<span class="token punctuation">.</span><span class="token function">createWriteStream</span><span class="token punctuation">(</span>changelogPath<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>resultArray<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token function">cb</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

</code></pre></div><p>惊喜的发现 conventional-changelog 木得 @types 库，继续手动添加</p> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token comment">// typings/index.d.ts</span>

<span class="token keyword">declare</span> <span class="token keyword">module</span> <span class="token string">'conventional-changelog'</span>
</code></pre></div><h3 id="参考-commit-7"><a href="#参考-commit-7" class="header-anchor">#</a> 参考 commit</h3> <p><a href="https://github.com/simonwong/fly-helper/commit/1f31ab05ad81e5f726a4b3ee7b73a0c6bf3e8566" target="_blank" rel="noopener noreferrer">1f31ab<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h3 id="ps-2"><a href="#ps-2" class="header-anchor">#</a> Ps</h3> <p>使用 conventional-changelog 需要注意一下</p> <ul><li>非常注意 commit 格式，格式采用 <a href="https://github.com/angular/angular/blob/master/CONTRIBUTING.md" target="_blank" rel="noopener noreferrer">angular commit 规范<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>，会识别 feat 和 fix 开头的 commit ，然后自动生成</li> <li>每次更改需要先升级 version 再去生成。后面会有例子</li></ul> <h2 id="优化开发流程"><a href="#优化开发流程" class="header-anchor">#</a> 优化开发流程</h2> <h3 id="安装-7"><a href="#安装-7" class="header-anchor">#</a> 安装</h3> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">yarn</span> <span class="token function">add</span> -D husky lint-staged
</code></pre></div><h3 id="package-json"><a href="#package-json" class="header-anchor">#</a> package.json</h3> <p>话不多说，看代码</p> <div class="language-json extra-class"><pre class="language-json"><code>  <span class="token property">&quot;husky&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;hooks&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">&quot;pre-commit&quot;</span><span class="token operator">:</span> <span class="token string">&quot;lint-staged &amp; jest -u&quot;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">&quot;lint-staged&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;*.{.ts,.js}&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token string">&quot;eslint&quot;</span><span class="token punctuation">,</span>
      <span class="token string">&quot;git add&quot;</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
</code></pre></div><p>之后提交代码都会先 lint 验证，再 jest 测试通过，才可以提交。规范团队协作的代码规范</p> <h2 id="优化发布流程"><a href="#优化发布流程" class="header-anchor">#</a> 优化发布流程</h2> <h3 id="package-json-2"><a href="#package-json-2" class="header-anchor">#</a> package.json</h3> <div class="language-json extra-class"><pre class="language-json"><code><span class="token comment">/* pushlish 的文件 */</span>
<span class="token property">&quot;files&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token string">&quot;lib&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;LICENSE&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;CHANGELOG.md&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;README.md&quot;</span>
<span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token comment">/* 使得支持 tree shaking */</span>
<span class="token property">&quot;sideEffects&quot;</span><span class="token operator">:</span> <span class="token string">&quot;false&quot;</span><span class="token punctuation">,</span>
<span class="token property">&quot;script&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token comment">/* ... */</span>
    <span class="token property">&quot;changelog&quot;</span><span class="token operator">:</span> <span class="token string">&quot;gulp changelog&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;prepublishOnly&quot;</span><span class="token operator">:</span> <span class="token string">&quot;yarn lint &amp; yarn test &amp; yarn changelog &amp; yarn build&quot;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>prepublishOnly 可以在 publish 的时候，先 lint 验证， 再 jest 测试 ， 再生成 changlog ，最后打包，最后发布。</p> <p>至此，我们已经实现了全部需求。🥳</p> <h3 id="参考-commit-8"><a href="#参考-commit-8" class="header-anchor">#</a> 参考 commit</h3> <p><a href="https://github.com/simonwong/fly-helper/commit/7f343fda98ce31bf055184ac60932def8cf81367" target="_blank" rel="noopener noreferrer">7f343f<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h2 id="changelog-例子"><a href="#changelog-例子" class="header-anchor">#</a> changelog 例子</h2> <ul><li><p>我们假装现在开始写第一个方法。我删除了上面的例子，增加了一个 calculate.ts</p> <p>请看<a href="https://github.com/simonwong/fly-helper/tree/release/1.0.0" target="_blank" rel="noopener noreferrer">仓库地址 release/1.0.0 分支<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></li> <li><p>然后我们提交这次更改，commit 内容为 <code>feat: 新增 calculateOneAddOne 计算 1 + 1 方法</code></p></li> <li><p>执行 npm version major 升级主版本号 1.0.0。</p> <p><a href="https://simonwong.github.io/advanced/npm.html#version" target="_blank" rel="noopener noreferrer">更多升级版本的操作<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>版本规范参考 <a href="https://semver.org/lang/zh-CN/" target="_blank" rel="noopener noreferrer">语义化版本 2.0.0<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></li> <li><p><code>yarn changelog</code> 看看你的 changelog.md 就自动生成了🥳</p></li></ul> <p><img src="http://file.wangsijie.top/blog/20191227100915.png" alt=""></p> <h3 id="仓库地址"><a href="#仓库地址" class="header-anchor">#</a> 仓库地址</h3> <p><a href="https://github.com/simonwong/fly-helper/tree/release/1.0.0" target="_blank" rel="noopener noreferrer">fly-helper/release/1.0.0<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h2 id="参考"><a href="#参考" class="header-anchor">#</a> 参考</h2> <p><a href="https://ts.xcatliu.com/" target="_blank" rel="noopener noreferrer">TypeScript 入门教程<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="https://microsoft.github.io/TypeSearch/" target="_blank" rel="noopener noreferrer">TypeSearch<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="https://eslint.org/blog/2019/01/future-typescript-eslint" target="_blank" rel="noopener noreferrer">The future of TypeScript on ESLint<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="https://www.rollupjs.com/" target="_blank" rel="noopener noreferrer">Rollup.js 中文网<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="https://github.com/rollup/rollup/wiki/pkg.module" target="_blank" rel="noopener noreferrer">rollup - pkg.module<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <blockquote><p>If you're writing a package, strongly consider using <code>pkg.module</code></p></blockquote> <p><a href="https://jestjs.io/docs/zh-Hans/getting-started" target="_blank" rel="noopener noreferrer">jest 中文文档<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="https://api-extractor.com/" target="_blank" rel="noopener noreferrer">api-extractor<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="https://github.com/microsoft/tsdoc" target="_blank" rel="noopener noreferrer">tsdoc<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="https://www.gulpjs.com.cn/docs/getting-started/quick-start/" target="_blank" rel="noopener noreferrer">gulp<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="https://www.ruanyifeng.com/blog/2016/01/commit_message_change_log.html" target="_blank" rel="noopener noreferrer">Commit message 和 Change log 编写指南<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">7 个月前</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/share/浏览器工作原理与实践/7.浏览器安全.html" class="prev">
        浏览器安全
      </a></span> <span class="next"><a href="/share/从webpack打包看前端模块化.html">
        从 webpack 打包看前端模块化
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----><!----></div></div>
    <script src="/assets/js/app.b10b90d4.js" defer></script><script src="/assets/js/2.aba2ec75.js" defer></script><script src="/assets/js/80.0abc5f87.js" defer></script><script src="/assets/js/3.a992b9fe.js" defer></script>
  </body>
</html>
