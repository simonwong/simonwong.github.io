"use strict";(self.webpackChunknote=self.webpackChunknote||[]).push([[5851],{3905:function(e,n,t){t.d(n,{Zo:function(){return c},kt:function(){return d}});var l=t(7294);function r(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function a(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);n&&(l=l.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,l)}return t}function i(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?a(Object(t),!0).forEach((function(n){r(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):a(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function p(e,n){if(null==e)return{};var t,l,r=function(e,n){if(null==e)return{};var t,l,r={},a=Object.keys(e);for(l=0;l<a.length;l++)t=a[l],n.indexOf(t)>=0||(r[t]=e[t]);return r}(e,n);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(l=0;l<a.length;l++)t=a[l],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(r[t]=e[t])}return r}var o=l.createContext({}),s=function(e){var n=l.useContext(o),t=n;return e&&(t="function"==typeof e?e(n):i(i({},n),e)),t},c=function(e){var n=s(e.components);return l.createElement(o.Provider,{value:n},e.children)},u={inlineCode:"code",wrapper:function(e){var n=e.children;return l.createElement(l.Fragment,{},n)}},m=l.forwardRef((function(e,n){var t=e.components,r=e.mdxType,a=e.originalType,o=e.parentName,c=p(e,["components","mdxType","originalType","parentName"]),m=s(t),d=r,g=m["".concat(o,".").concat(d)]||m[d]||u[d]||a;return t?l.createElement(g,i(i({ref:n},c),{},{components:t})):l.createElement(g,i({ref:n},c))}));function d(e,n){var t=arguments,r=n&&n.mdxType;if("string"==typeof e||r){var a=t.length,i=new Array(a);i[0]=m;var p={};for(var o in n)hasOwnProperty.call(n,o)&&(p[o]=n[o]);p.originalType=e,p.mdxType="string"==typeof e?e:r,i[1]=p;for(var s=2;s<a;s++)i[s]=t[s];return l.createElement.apply(null,i)}return l.createElement.apply(null,t)}m.displayName="MDXCreateElement"},6411:function(e,n,t){t.r(n),t.d(n,{frontMatter:function(){return p},contentTitle:function(){return o},metadata:function(){return s},toc:function(){return c},default:function(){return m}});var l=t(7462),r=t(3366),a=(t(7294),t(3905)),i=["components"],p={},o="TypeScript\u3001Rollup \u642d\u5efa\u5de5\u5177\u5e93",s={unversionedId:"share/TypeScript\u3001Rollup\u642d\u5efa\u5de5\u5177\u5e93",id:"share/TypeScript\u3001Rollup\u642d\u5efa\u5de5\u5177\u5e93",isDocsHomePage:!1,title:"TypeScript\u3001Rollup \u642d\u5efa\u5de5\u5177\u5e93",description:"\u524d\u666f\u63d0\u8981",source:"@site/docs/share/TypeScript\u3001Rollup\u642d\u5efa\u5de5\u5177\u5e93.md",sourceDirName:"share",slug:"/share/TypeScript\u3001Rollup\u642d\u5efa\u5de5\u5177\u5e93",permalink:"/docs/share/TypeScript\u3001Rollup\u642d\u5efa\u5de5\u5177\u5e93",editUrl:"https://github.com/facebook/docusaurus/edit/master/website/docs/share/TypeScript\u3001Rollup\u642d\u5efa\u5de5\u5177\u5e93.md",tags:[],version:"current",frontMatter:{},sidebar:"share",previous:{title:"\u6d4f\u89c8\u5668\u5b89\u5168",permalink:"/docs/share/\u6d4f\u89c8\u5668\u5de5\u4f5c\u539f\u7406\u4e0e\u5b9e\u8df5/\u6d4f\u89c8\u5668\u5b89\u5168"},next:{title:"\u4ece webpack \u6253\u5305\u770b\u524d\u7aef\u6a21\u5757\u5316",permalink:"/docs/share/\u4ecewebpack\u6253\u5305\u770b\u524d\u7aef\u6a21\u5757\u5316"}},c=[{value:"\u524d\u666f\u63d0\u8981",id:"\u524d\u666f\u63d0\u8981",children:[{value:"\u6d89\u53ca\u7684\u5e93",id:"\u6d89\u53ca\u7684\u5e93",children:[]}]},{value:"\u521d\u59cb\u5316\u9879\u76ee",id:"\u521d\u59cb\u5316\u9879\u76ee",children:[{value:"\u5b89\u88c5 TypeScript",id:"\u5b89\u88c5-typescript",children:[]},{value:"\u914d\u7f6e tsconfig.json",id:"\u914d\u7f6e-tsconfigjson",children:[]},{value:"\u53c2\u8003 commit",id:"\u53c2\u8003-commit",children:[]}]},{value:"\u914d\u7f6e eslint",id:"\u914d\u7f6e-eslint",children:[{value:"\u5b89\u88c5",id:"\u5b89\u88c5",children:[]},{value:"\u76ee\u5f55\u7ed3\u6784",id:"\u76ee\u5f55\u7ed3\u6784",children:[]},{value:"Ps",id:"ps",children:[]},{value:"\u914d\u7f6e tsconfig.eslint.json",id:"\u914d\u7f6e-tsconfigeslintjson",children:[]},{value:"\u914d\u7f6e .eslintrc.js",id:"\u914d\u7f6e-eslintrcjs",children:[]},{value:"\u53c2\u8003 commit",id:"\u53c2\u8003-commit-1",children:[]}]},{value:"\u914d\u7f6e rollup",id:"\u914d\u7f6e-rollup",children:[{value:"\u5b89\u88c5",id:"\u5b89\u88c5-1",children:[]},{value:"\u76ee\u5f55\u7ed3\u6784",id:"\u76ee\u5f55\u7ed3\u6784-1",children:[]},{value:"\u914d\u7f6e .babelrc",id:"\u914d\u7f6e-babelrc",children:[]},{value:"\u914d\u7f6e rollup.config.ts",id:"\u914d\u7f6e-rollupconfigts",children:[]},{value:"\u914d\u7f6e\u58f0\u660e\u6587\u4ef6",id:"\u914d\u7f6e\u58f0\u660e\u6587\u4ef6",children:[]},{value:"\u8bd5\u4e00\u4e0b",id:"\u8bd5\u4e00\u4e0b",children:[]},{value:"\u53c2\u8003 commit",id:"\u53c2\u8003-commit-2",children:[]}]},{value:"\u914d\u7f6e jest",id:"\u914d\u7f6e-jest",children:[{value:"\u5b89\u88c5",id:"\u5b89\u88c5-2",children:[]},{value:"\u76ee\u5f55\u7ed3\u6784",id:"\u76ee\u5f55\u7ed3\u6784-2",children:[]},{value:"\u914d\u7f6e jest.config.js",id:"\u914d\u7f6e-jestconfigjs",children:[]},{value:"\u52a8\u624b\u5199\u4e2a test \u5427",id:"\u52a8\u624b\u5199\u4e2a-test-\u5427",children:[]},{value:"\u518d\u914d\u7f6e eslint",id:"\u518d\u914d\u7f6e-eslint",children:[]},{value:"\u589e\u52a0 package.json scripts",id:"\u589e\u52a0-packagejson-scripts",children:[]},{value:"\u8bd5\u4e00\u4e0b",id:"\u8bd5\u4e00\u4e0b-1",children:[]},{value:"\u53c2\u8003 commit",id:"\u53c2\u8003-commit-3",children:[]}]},{value:"\u914d\u7f6e @microsoft/api-extractor",id:"\u914d\u7f6e-microsoftapi-extractor",children:[{value:"\u5b89\u88c5",id:"\u5b89\u88c5-3",children:[]},{value:"\u914d\u7f6e api-extractor.json",id:"\u914d\u7f6e-api-extractorjson",children:[]},{value:"\u589e\u52a0 package.json scripts",id:"\u589e\u52a0-packagejson-scripts-1",children:[]},{value:"\u5c1d\u8bd5\u4e00\u4e0b",id:"\u5c1d\u8bd5\u4e00\u4e0b",children:[]},{value:"\u53c2\u8003 commit",id:"\u53c2\u8003-commit-4",children:[]}]},{value:"gulp \u81ea\u52a8\u5316\u6784\u5efa",id:"gulp-\u81ea\u52a8\u5316\u6784\u5efa",children:[{value:"\u5b89\u88c5",id:"\u5b89\u88c5-4",children:[]},{value:"\u914d\u7f6e package.json",id:"\u914d\u7f6e-packagejson",children:[]},{value:"\u914d\u7f6e gulpfile",id:"\u914d\u7f6e-gulpfile",children:[]},{value:"\u5c1d\u8bd5\u4e00\u4e0b",id:"\u5c1d\u8bd5\u4e00\u4e0b-1",children:[]},{value:"\u53c2\u8003 commit",id:"\u53c2\u8003-commit-5",children:[]}]},{value:"changelog \u81ea\u52a8\u751f\u6210",id:"changelog-\u81ea\u52a8\u751f\u6210",children:[{value:"\u5b89\u88c5",id:"\u5b89\u88c5-5",children:[]},{value:"\u914d\u7f6e gulpfile",id:"\u914d\u7f6e-gulpfile-1",children:[]},{value:"\u53c2\u8003 commit",id:"\u53c2\u8003-commit-6",children:[]},{value:"Ps",id:"ps-1",children:[]}]},{value:"\u4f18\u5316\u5f00\u53d1\u6d41\u7a0b",id:"\u4f18\u5316\u5f00\u53d1\u6d41\u7a0b",children:[{value:"\u5b89\u88c5",id:"\u5b89\u88c5-6",children:[]},{value:"package.json",id:"packagejson",children:[]}]},{value:"\u4f18\u5316\u53d1\u5e03\u6d41\u7a0b",id:"\u4f18\u5316\u53d1\u5e03\u6d41\u7a0b",children:[{value:"package.json",id:"packagejson-1",children:[]},{value:"\u53c2\u8003 commit",id:"\u53c2\u8003-commit-7",children:[]}]},{value:"changelog \u4f8b\u5b50",id:"changelog-\u4f8b\u5b50",children:[{value:"\u4ed3\u5e93\u5730\u5740",id:"\u4ed3\u5e93\u5730\u5740",children:[]}]},{value:"\u53c2\u8003",id:"\u53c2\u8003",children:[]}],u={toc:c};function m(e){var n=e.components,t=(0,r.Z)(e,i);return(0,a.kt)("wrapper",(0,l.Z)({},u,t,{components:n,mdxType:"MDXLayout"}),(0,a.kt)("h1",{id:"typescriptrollup-\u642d\u5efa\u5de5\u5177\u5e93"},"TypeScript\u3001Rollup \u642d\u5efa\u5de5\u5177\u5e93"),(0,a.kt)("p",null,(0,a.kt)("img",{parentName:"p",src:"http://file.wangsijie.top/blog/20191226183850.png",alt:null})),(0,a.kt)("h2",{id:"\u524d\u666f\u63d0\u8981"},"\u524d\u666f\u63d0\u8981"),(0,a.kt)("p",null,"\u516c\u53f8\u5185\u603b\u662f\u6709\u8bb8\u591a\u901a\u7528\u7684\u5de5\u5177\u65b9\u6cd5\u3001\u4e1a\u52a1\u529f\u80fd\uff0c\u6211\u4eec\u53ef\u4ee5\u642d\u5efa\u4e00\u4e2a\u5de5\u5177\u5e93\u6765\u7ed9\u5404\u4e2a\u9879\u76ee\u4f7f\u7528\u3002"),(0,a.kt)("p",null,"\u8981\u5b9e\u73b0\u7684\u9700\u6c42\uff1a\ud83e\udd14"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"\u652f\u6301\u7f16\u8f91\u5668\u7684\u5feb\u901f\u8865\u5168\u548c\u63d0\u793a"),(0,a.kt)("li",{parentName:"ul"},"\u81ea\u52a8\u5316\u6784\u5efa"),(0,a.kt)("li",{parentName:"ul"},"\u652f\u6301\u81ea\u52a8\u751f\u6210 changlog"),(0,a.kt)("li",{parentName:"ul"},"\u4ee3\u7801\u901a\u8fc7 lint \u548c\u6d4b\u8bd5\u540e\u624d\u80fd\u63d0\u4ea4\u3001\u53d1\u5e03")),(0,a.kt)("h3",{id:"\u6d89\u53ca\u7684\u5e93"},"\u6d89\u53ca\u7684\u5e93"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"eslint + @typescript-eslint/parser"),(0,a.kt)("li",{parentName:"ul"},"rollup"),(0,a.kt)("li",{parentName:"ul"},"jest"),(0,a.kt)("li",{parentName:"ul"},"@microsoft/api-extractor"),(0,a.kt)("li",{parentName:"ul"},"gulp")),(0,a.kt)("h2",{id:"\u521d\u59cb\u5316\u9879\u76ee"},"\u521d\u59cb\u5316\u9879\u76ee"),(0,a.kt)("p",null,"\u65b0\u5efa\u4e00\u4e2a\u9879\u76ee\u76ee\u5f55\u5982 ",(0,a.kt)("inlineCode",{parentName:"p"},"fly-helper")," , \u5e76 ",(0,a.kt)("inlineCode",{parentName:"p"},"npm init")," \u521d\u59cb\u5316\u9879\u76ee\u3002"),(0,a.kt)("h3",{id:"\u5b89\u88c5-typescript"},"\u5b89\u88c5 ",(0,a.kt)("a",{parentName:"h3",href:"https://www.tslang.cn/docs/home.html"},"TypeScript")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-shell"},"yarn add -D typescript\n")),(0,a.kt)("p",null,"\u521b\u5efa ",(0,a.kt)("inlineCode",{parentName:"p"},"src")," \u76ee\u5f55\uff0c\u5165\u53e3\u6587\u4ef6\uff0c\u4ee5\u53ca ts \u7684\u914d\u7f6e\u6587\u4ef6"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"fly-helper\n |\n |- src\n     |- index.ts\n |- tsconfig.json\n")),(0,a.kt)("h3",{id:"\u914d\u7f6e-tsconfigjson"},"\u914d\u7f6e tsconfig.json"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-json"},'/*  tsconfig.json */\n{\n  "compilerOptions": {\n    /* \u57fa\u7840\u914d\u7f6e */\n    "target": "esnext",\n    "lib": [\n      "dom",\n      "esnext"\n    ],\n    "removeComments": false,\n    "declaration": true,\n    "sourceMap": true,\n\n    /* \u5f3a\u7c7b\u578b\u68c0\u67e5\u914d\u7f6e */\n    "strict": true,\n    "noImplicitAny": false,\n\n    /* \u6a21\u5757\u5206\u6790\u914d\u7f6e */\n    "baseUrl": ".",\n    "outDir": "./lib",\n    "esModuleInterop": true,\n    "moduleResolution": "node",\n    "resolveJsonModule": true\n  },\n  "include": [\n    "src"\n  ]\n}\n')),(0,a.kt)("h3",{id:"\u53c2\u8003-commit"},"\u53c2\u8003 commit"),(0,a.kt)("p",null," ",(0,a.kt)("a",{parentName:"p",href:"https://github.com/simonwong/fly-helper/commit/1892d46aa6131806f720581737af60ea0c2fd4c2"},"1892d4")),(0,a.kt)("p",null,"Ps\uff1acommit \u4e2d\u8fd8\u589e\u52a0\u4e86 .editorconfig  \uff0c\u6765\u7ea6\u675f\u540c\u5b66\u4eec\u7684\u4ee3\u7801\u683c\u5f0f"),(0,a.kt)("h2",{id:"\u914d\u7f6e-eslint"},"\u914d\u7f6e eslint"),(0,a.kt)("p",null,"TypeScirpt \u5df2\u7ecf\u5168\u9762\u91c7\u7528 ESLint \u4f5c\u4e3a\u4ee3\u7801\u68c0\u67e5 ",(0,a.kt)("a",{parentName:"p",href:"https://eslint.org/blog/2019/01/future-typescript-eslint"},"The future of TypeScript on ESLint")),(0,a.kt)("p",null,"\u5e76\u4e14\u63d0\u4f9b\u4e86 TypeScript \u6587\u4ef6\u7684\u89e3\u6790\u5668 ",(0,a.kt)("a",{parentName:"p",href:"https://github.com/typescript-eslint/typescript-eslint/tree/master/packages/parser"},"@typescript-eslint/parser")," \u548c\u914d\u7f6e\u9009\u9879 ",(0,a.kt)("a",{parentName:"p",href:"https://github.com/typescript-eslint/typescript-eslint/tree/master/packages/eslint-plugin"},"@typescript-eslint/eslint-plugin")),(0,a.kt)("h3",{id:"\u5b89\u88c5"},"\u5b89\u88c5"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-shell"},"yarn add -D eslint @typescript-eslint/parser @typescript-eslint/eslint-plugin \n")),(0,a.kt)("h3",{id:"\u76ee\u5f55\u7ed3\u6784"},"\u76ee\u5f55\u7ed3\u6784"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"fly-helper\n |- .eslintignore\n |- .eslintrc.js\n |- tsconfig.eslint.json\n")),(0,a.kt)("h3",{id:"ps"},"Ps"),(0,a.kt)("p",null,"tsconfig.eslint.json \u6211\u4eec\u6839\u76ee\u5f55\u4e2d\u589e\u52a0\u4e86\u4e00\u4e2a tsconfig \u6587\u4ef6\uff0c\u5b83\u5c06\u7528\u4e8e ",(0,a.kt)("inlineCode",{parentName:"p"},"eslintrc.parserOptions.project")," \uff0c\u7531\u4e8e\u8be5\u914d\u7f6e\u8981\u6c42 incude \u6bcf\u4e2a ts\u3001js \u6587\u4ef6\u3002\u800c\u6211\u4eec\u4ec5\u9700\u8981\u6253\u5305 src \u76ee\u5f55\u4e0b\u7684\u4ee3\u7801\uff0c\u6240\u4ee5\u589e\u52a0\u4e86\u8be5\u914d\u7f6e\u6587\u4ef6\u3002"),(0,a.kt)("p",null,"\u5982\u679c ",(0,a.kt)("inlineCode",{parentName:"p"},"eslintrc.parserOptions.project")," \u914d\u7f6e\u4e3a tsconfig.json \u3002src \u6587\u4ef6\u4ee5\u5916\u7684 ts\u3001js \u6587\u4ef6\u90fd\u4f1a\u62a5\u9519\u3002"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},'Parsing error: "parserOptions.project" has been set for @typescript-eslint/parser.\nThe file does not match your project config: config.ts.\nThe file must be included in at least one of the projects provided.eslint\n')),(0,a.kt)("p",null,"\u867d\u7136\u53ef\u4ee5\u914d\u7f6e ",(0,a.kt)("inlineCode",{parentName:"p"},"eslintrc.parserOptions.createDefaultProgram")," \u4f46\u4f1a\u9020\u6210\u5de8\u5927\u7684\u6027\u80fd\u635f\u8017\u3002"),(0,a.kt)("p",null,(0,a.kt)("a",{parentName:"p",href:"https://github.com/typescript-eslint/typescript-eslint/issues/967"},'issus: Parsing error: "parserOptions.project"...')),(0,a.kt)("h3",{id:"\u914d\u7f6e-tsconfigeslintjson"},"\u914d\u7f6e tsconfig.eslint.json"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-json"},'/* tsconfig.eslint.json */\n{\n  "compilerOptions": {\n    "baseUrl": ".",\n    "resolveJsonModule": true,\n  },\n  "include": [\n    "**/*.ts",\n    "**/*.js"\n  ]\n}\n')),(0,a.kt)("h3",{id:"\u914d\u7f6e-eslintrcjs"},"\u914d\u7f6e .eslintrc.js"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-javascript"},"// .eslintrc.js\nconst eslintrc = {\n    parser: '@typescript-eslint/parser', // \u4f7f\u7528 ts \u89e3\u6790\u5668\n    extends: [\n        'eslint:recommended', // eslint \u63a8\u8350\u89c4\u5219\n        'plugin:@typescript-eslint/recommended', // ts \u63a8\u8350\u89c4\u5219\n    ],\n    plugins: [\n        '@typescript-eslint',\n    ],\n    env: {\n        browser: true,\n        node: true,\n        es6: true,\n    },\n    parserOptions: {\n        project: './tsconfig.eslint.json',\n        ecmaVersion: 2019,\n        sourceType: 'module',\n        ecmaFeatures: {\n          experimentalObjectRestSpread: true\n        }\n    },\n    rules: {}, // \u81ea\u5b9a\u4e49\n}\n\nmodule.exports = eslintrc\n")),(0,a.kt)("h3",{id:"\u53c2\u8003-commit-1"},"\u53c2\u8003 commit"),(0,a.kt)("p",null,(0,a.kt)("a",{parentName:"p",href:"https://github.com/simonwong/fly-helper/commit/36f63d7ae4140ed32388b5111d0f537909e7c81d"},"36f63d")),(0,a.kt)("h2",{id:"\u914d\u7f6e-rollup"},"\u914d\u7f6e rollup"),(0,a.kt)("p",null,"vue\u3001react \u7b49\u8bb8\u591a\u6d41\u884c\u5e93\u90fd\u5728\u4f7f\u7528 Rollup.js \uff0c\u5c31\u4e0d\u591a\u4ecb\u7ecd\uff0c\u76f4\u63a5\u770b ",(0,a.kt)("a",{parentName:"p",href:"https://www.rollupjs.com/"},"\u5b98\u7f51")," \u5427\ud83e\udd2f"),(0,a.kt)("h3",{id:"\u5b89\u88c5-1"},"\u5b89\u88c5"),(0,a.kt)("p",null,"\u5b89\u88c5 rollup \u4ee5\u53ca\u8981\u7528\u5230\u7684\u63d2\u4ef6"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-shell"},"yarn add -D rollup rollup-plugin-babel rollup-plugin-commonjs rollup-plugin-eslint rollup-plugin-node-resolve rollup-plugin-typescript2\n")),(0,a.kt)("p",null,"\u5b89\u88c5 babel \u76f8\u5173\u7684\u5e93"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-shell"},"yarn add -D @babel/preset-env\n")),(0,a.kt)("h3",{id:"\u76ee\u5f55\u7ed3\u6784-1"},"\u76ee\u5f55\u7ed3\u6784"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"fly-helper\n |\n |- typings\n     |- index.d.ts\n |- .babelrc\n |- rollup.config.ts\n")),(0,a.kt)("h3",{id:"\u914d\u7f6e-babelrc"},"\u914d\u7f6e .babelrc"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-json"},'/* .babelrc */\n{\n  "presets": [\n    [\n      "@babel/preset-env",\n      {\n        /* Babel \u4f1a\u5728 Rollup \u6709\u673a\u4f1a\u505a\u5904\u7406\u4e4b\u524d\uff0c\u5c06\u6211\u4eec\u7684\u6a21\u5757\u8f6c\u6210 CommonJS\uff0c\u5bfc\u81f4 Rollup \u7684\u4e00\u4e9b\u5904\u7406\u5931\u8d25 */\n        "modules": false\n      }\n    ]\n  ]\n}\n')),(0,a.kt)("h3",{id:"\u914d\u7f6e-rollupconfigts"},"\u914d\u7f6e rollup.config.ts"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-typescript"},"import path from 'path'\nimport { RollupOptions } from 'rollup'\nimport rollupTypescript from 'rollup-plugin-typescript2'\nimport babel from 'rollup-plugin-babel'\nimport resolve from 'rollup-plugin-node-resolve'\nimport commonjs from 'rollup-plugin-commonjs'\nimport { eslint } from 'rollup-plugin-eslint'\nimport { DEFAULT_EXTENSIONS } from '@babel/core'\n\nimport pkg from './package.json'\n\nconst paths = {\n  input: path.join(__dirname, '/src/index.ts'),\n  output: path.join(__dirname, '/lib'),\n}\n\n// rollup \u914d\u7f6e\u9879\nconst rollupConfig: RollupOptions = {\n  input: paths.input,\n  output: [\n    // \u8f93\u51fa commonjs \u89c4\u8303\u7684\u4ee3\u7801\n    {\n      file: path.join(paths.output, 'index.js'),\n      format: 'cjs',\n      name: pkg.name,\n    },\n    // \u8f93\u51fa es \u89c4\u8303\u7684\u4ee3\u7801\n    {\n      file: path.join(paths.output, 'index.esm.js'),\n      format: 'es',\n      name: pkg.name,\n    },\n  ],\n  // external: ['lodash'], // \u6307\u51fa\u5e94\u5c06\u54ea\u4e9b\u6a21\u5757\u89c6\u4e3a\u5916\u90e8\u6a21\u5757\uff0c\u5982 Peer dependencies \u4e2d\u7684\u4f9d\u8d56\n  // plugins \u9700\u8981\u6ce8\u610f\u5f15\u7528\u987a\u5e8f\n  plugins: [\n    // \u9a8c\u8bc1\u5bfc\u5165\u7684\u6587\u4ef6\n    eslint({\n      throwOnError: true, // lint \u7ed3\u679c\u6709\u9519\u8bef\u5c06\u4f1a\u629b\u51fa\u5f02\u5e38\n      throwOnWarning: true,\n      include: ['src/**/*.ts'],\n      exclude: ['node_modules/**', 'lib/**', '*.js'],\n    }),\n\n    // \u4f7f\u5f97 rollup \u652f\u6301 commonjs \u89c4\u8303\uff0c\u8bc6\u522b commonjs \u89c4\u8303\u7684\u4f9d\u8d56\n    commonjs(),\n\n    // \u914d\u5408 commnjs \u89e3\u6790\u7b2c\u4e09\u65b9\u6a21\u5757\n    resolve({\n      // \u5c06\u81ea\u5b9a\u4e49\u9009\u9879\u4f20\u9012\u7ed9\u89e3\u6790\u63d2\u4ef6\n      customResolveOptions: {\n        moduleDirectory: 'node_modules',\n      },\n    }),\n    rollupTypescript(),\n    babel({\n      runtimeHelpers: true,\n      // \u53ea\u8f6c\u6362\u6e90\u4ee3\u7801\uff0c\u4e0d\u8fd0\u884c\u5916\u90e8\u4f9d\u8d56\n      exclude: 'node_modules/**',\n      // babel \u9ed8\u8ba4\u4e0d\u652f\u6301 ts \u9700\u8981\u624b\u52a8\u6dfb\u52a0\n      extensions: [\n        ...DEFAULT_EXTENSIONS,\n        '.ts',\n      ],\n    }),\n  ],\n}\n\nexport default rollupConfig\n")),(0,a.kt)("p",null,"\u4e00\u4e9b\u6ce8\u610f\u4e8b\u9879\uff1a"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"plugins \u5fc5\u987b\u6709\u987a\u5e8f\u7684\u4f7f\u7528"),(0,a.kt)("li",{parentName:"ul"},"external \u6765\u8bbe\u7f6e\u4e09\u65b9\u5e93\u4e3a\u5916\u90e8\u6a21\u5757\uff0c\u5426\u5219\u4e5f\u4f1a\u88ab\u6253\u5305\u8fdb\u53bb\uff0c\u53d8\u5f97\u975e\u5e38\u5927\u54e6")),(0,a.kt)("h3",{id:"\u914d\u7f6e\u58f0\u660e\u6587\u4ef6"},"\u914d\u7f6e\u58f0\u660e\u6587\u4ef6"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-typescript"},"declare module 'rollup-plugin-babel'\ndeclare module 'rollup-plugin-eslint'\n")),(0,a.kt)("p",null,"\u7531\u4e8e\u90e8\u5206\u63d2\u4ef6\u8fd8\u6ca1\u6709 @types \u5e93\uff0c\u6240\u4ee5\u6211\u4eec\u624b\u52a8\u6dfb\u52a0\u58f0\u660e\u6587\u4ef6"),(0,a.kt)("h3",{id:"\u8bd5\u4e00\u4e0b"},"\u8bd5\u4e00\u4e0b"),(0,a.kt)("p",null,"\u6211\u4eec\u5728 index.ts \u6587\u4ef6\u4e0b\uff0c\u968f\u610f\u52a0\u5165\u4e00\u4e2a\u65b9\u6cd5"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-typescript"},"export default function myFirstFunc (str: string) {\n  return `hello ${str}`\n}\n")),(0,a.kt)("p",null,"\u7531\u4e8e\u4f7f\u7528\u4e86 ",(0,a.kt)("inlineCode",{parentName:"p"},"RollupOptions")," \u63a5\u53e3\uff0c\u76f4\u63a5\u6267\u884c\u4f1a\u62a5\u9519\u3002\u6211\u4eec\u8981\u6ce8\u91ca\u6389\u7b2c2\u884c",(0,a.kt)("inlineCode",{parentName:"p"},"import { RollupOptions } from 'rollup'"),"\uff0c\u548c\u7b2c17\u884c ",(0,a.kt)("inlineCode",{parentName:"p"},"const rollupConfig")," \u540e\u9762\u7684 ",(0,a.kt)("inlineCode",{parentName:"p"},": RollupOptions"),"\u3002"),(0,a.kt)("p",null,"\u7136\u540e\u6267\u884c ",(0,a.kt)("inlineCode",{parentName:"p"},"npx rollup --c rollup.config.ts")),(0,a.kt)("p",null,"\u5c31\u751f\u6210\u4e86 index.js \u548c index.esm.js \u6587\u4ef6\u3002\u5206\u522b\u5bf9\u5e94\u7740 commonjs \u89c4\u8303\u548c es \u89c4\u8303\u7684\u6587\u4ef6\u3002rollup \u53ef\u662f\u5927\u529b\u63a8\u884c es \u89c4\u8303\u554a\uff0c\u7136\u540e\u6211\u4eec\u5f88\u591a\u4e09\u65b9\u5e93\u90fd\u4ecd\u65e7\u4f7f\u7528 commonjs \u89c4\u8303\uff0c\u4e3a\u4e86\u517c\u5bb9\uff0c\u6211\u4eec\u4e24\u79cd\u89c4\u8303\u90fd\u751f\u6210\u3002"),(0,a.kt)("p",null,"\u7531\u4e8e\u4f7f\u7528\u4e86 ts \uff0c\u53ef\u4ee5\u5f88\u65b9\u4fbf\u7684\u5b9e\u73b0\u5feb\u901f\u8865\u5168\u7684\u9700\u6c42\uff0c\u6309\u7167\u4e0a\u9762\u7684\u4f8b\u5b50\uff0c\u9879\u76ee\u4e2d\u4f7f\u7528\u8fd9\u4e2a\u5305\u540e\uff0cvscode \u4e0a\u8f93\u5165\u5c31\u4f1a\u6709\u5982\u4e0b\u6548\u679c"),(0,a.kt)("p",null,(0,a.kt)("img",{parentName:"p",src:"http://file.wangsijie.top/blog/20191226114541.png",alt:null})),(0,a.kt)("h3",{id:"\u53c2\u8003-commit-2"},"\u53c2\u8003 commit"),(0,a.kt)("p",null,(0,a.kt)("a",{parentName:"p",href:"https://github.com/simonwong/fly-helper/commit/0aab814f129de73ef12b1652c43e04139000a2db"},"0aab81")),(0,a.kt)("h2",{id:"\u914d\u7f6e-jest"},"\u914d\u7f6e jest"),(0,a.kt)("p",null,"\u5de5\u5177\u5e93\u5f53\u7136\u8981\u5199\u6d4b\u8bd5\u5566\uff0c\u5feb\u5f00\u59cb\u5427"),(0,a.kt)("h3",{id:"\u5b89\u88c5-2"},"\u5b89\u88c5"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-shell"},"yarn add -D @types/jest eslint-plugin-jest jest ts-jest\n")),(0,a.kt)("h3",{id:"\u76ee\u5f55\u7ed3\u6784-2"},"\u76ee\u5f55\u7ed3\u6784"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"fly-helper\n |- test\n    |- index.test.ts\n |- jest.config.js\n")),(0,a.kt)("h3",{id:"\u914d\u7f6e-jestconfigjs"},"\u914d\u7f6e jest.config.js"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-javascript"},"// jest.config.js\nmodule.exports = {\n  preset: 'ts-jest',\n  testEnvironment: 'node',\n}\n")),(0,a.kt)("h3",{id:"\u52a8\u624b\u5199\u4e2a-test-\u5427"},"\u52a8\u624b\u5199\u4e2a test \u5427"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-typescript"},"// index.test.ts\n\nimport assert from 'assert'\nimport myFirstFunc from '../src'\n\ndescribe('validate:', () => {\n  /**\n   * myFirstFunc\n   */\n  describe('myFirstFunc', () => {\n    test(' return hello rollup ', () => {\n      assert.strictEqual(myFirstFunc('rollup'), 'hello rollup')\n    })\n  })\n})\n")),(0,a.kt)("h3",{id:"\u518d\u914d\u7f6e-eslint"},"\u518d\u914d\u7f6e eslint"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-javascript"},"const eslintrc = {\n  // ...\n  extends: [\n    // ...\n    'plugin:jest/recommended',\n  ],\n  plugins: [\n    // ...\n    'jest',\n  ],\n  // ...\n}\n")),(0,a.kt)("h3",{id:"\u589e\u52a0-packagejson-scripts"},"\u589e\u52a0 package.json scripts"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},'"test": "jest --coverage --verbose -u"\n')),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"coverage  \u8f93\u51fa\u6d4b\u8bd5\u8986\u76d6\u7387"),(0,a.kt)("li",{parentName:"ul"},"verbose \u5c42\u6b21\u663e\u793a\u6d4b\u8bd5\u5957\u4ef6\u4e2d\u6bcf\u4e2a\u6d4b\u8bd5\u7684\u7ed3\u679c\uff0c\u4f1a\u770b\u7740\u66f4\u52a0\u76f4\u89c2\u5566")),(0,a.kt)("h3",{id:"\u8bd5\u4e00\u4e0b-1"},"\u8bd5\u4e00\u4e0b"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"yarn test\n")),(0,a.kt)("p",null,"\u662f\u4e0d\u662f\u6210\u529f\u4e86\u5462\ud83d\ude0c"),(0,a.kt)("p",null,(0,a.kt)("img",{parentName:"p",src:"http://file.wangsijie.top/blog/20191226154137.png",alt:null})),(0,a.kt)("h3",{id:"\u53c2\u8003-commit-3"},"\u53c2\u8003 commit"),(0,a.kt)("p",null,(0,a.kt)("a",{parentName:"p",href:"https://github.com/simonwong/fly-helper/commit/9bbe5b1585ab709b8e0c1ad0ff8243b7c43b7bd7"},"9bbe5b")),(0,a.kt)("h2",{id:"\u914d\u7f6e-microsoftapi-extractor"},"\u914d\u7f6e @microsoft/api-extractor"),(0,a.kt)("p",null,"\u5f53\u6211\u4eec src \u4e0b\u6709\u591a\u4e2a\u6587\u4ef6\u65f6\uff0c\u6253\u5305\u540e\u4f1a\u751f\u6210\u591a\u4e2a\u58f0\u660e\u6587\u4ef6\u3002"),(0,a.kt)("p",null,"\u4f7f\u7528 @microsoft/api-extractor \u8fd9\u4e2a\u5e93\u662f\u4e3a\u4e86\u628a\u6240\u6709\u7684 .d.ts \u5408\u6210\u4e00\u4e2a\uff0c\u5e76\u4e14\uff0c\u8fd8\u662f\u53ef\u4ee5\u6839\u636e\u5199\u7684\u6ce8\u91ca\u81ea\u52a8\u751f\u6210\u6587\u6863\u3002"),(0,a.kt)("h3",{id:"\u5b89\u88c5-3"},"\u5b89\u88c5"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-shell"},"yarn add -D @microsoft/api-extractor\n")),(0,a.kt)("h3",{id:"\u914d\u7f6e-api-extractorjson"},"\u914d\u7f6e api-extractor.json"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-json"},'/* api-extractor.json */\n{\n  "$schema": "https://developer.microsoft.com/json-schemas/api-extractor/v7/api-extractor.schema.json",\n  "mainEntryPointFilePath": "./lib/index.d.ts",\n  "bundledPackages": [ ],\n  "dtsRollup": {\n    "enabled": true,\n    "untrimmedFilePath": "./lib/index.d.ts"\n  }\n}\n')),(0,a.kt)("h3",{id:"\u589e\u52a0-packagejson-scripts-1"},"\u589e\u52a0 package.json scripts"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},'"api": "api-extractor run",\n')),(0,a.kt)("h3",{id:"\u5c1d\u8bd5\u4e00\u4e0b"},"\u5c1d\u8bd5\u4e00\u4e0b"),(0,a.kt)("p",null,"\u4f60\u53ef\u4ee5\u5c1d\u8bd5\u591a\u5199\u51e0\u4e2a\u65b9\u6cd5\uff0c\u6253\u5305\u540e\u4f1a\u53d1\u73b0\u6709\u591a\u4e2a .d.ts \u6587\u4ef6\uff0c\u7136\u540e\u6267\u884c ",(0,a.kt)("inlineCode",{parentName:"p"},"yarn api")),(0,a.kt)("p",null,"\u52a0\u5165",(0,a.kt)("a",{parentName:"p",href:"https://github.com/microsoft/tsdoc"},"ts doc")," \u98ce\u683c\u6ce8\u91ca"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-typescript"},"/**\n * \u8fd4\u56de hello \u5f00\u5934\u7684\u5b57\u7b26\u4e32\n * @param str - input string\n * @returns 'hello xxx'\n * @example\n * ```ts\n * myFirstFunc('ts') => 'hello ts'\n * ```\n *\n * @beta\n * @author ziming\n */\n")),(0,a.kt)("p",null,"\u5728\u4f7f\u7528\u7684\u8be5\u65b9\u6cd5\u7684\u65f6\u5019\u5c31\u4f1a\u6709\u63d0\u793a\u5566"),(0,a.kt)("p",null,"\u8fd9\u91cc\u6211\u5df2\u7ecf\u589e\u52a0\u4e86\u4e24\u4e2a\u65b9\u6cd5\uff0c\u8bf7\u770b \u4e0b\u9762\u7684 commit"),(0,a.kt)("p",null,"\u6267\u884c\u540e\uff0c\u4f1a\u53d1\u73b0 \u58f0\u660e\u90fd\u5408\u5728 index.d.ts \u4e0a\u5566\u3002\u7136\u540e\u8981\u628a\u591a\u4f59\u7684\u7ed9\u5220\u9664\u6389\uff0c\u540e\u9762\u6539\u6210\u81ea\u52a8\u5220\u9664\u5b83\ud83d\ude15"),(0,a.kt)("p",null,"\ud83d\ude24\u8fd8\u6709\u4e00\u4e2a temp \u6587\u4ef6\u5939\uff0c\u54b1\u4eec\u914d\u7f6e\u4e00\u4e0b gitignore \u4e0d\u7136\u5b83\u63d0\u4ea4\u3002tsdoc-metadata.json \u53ef\u4ee5\u6682\u65f6\u4e0d\u7ba1\u5b83\uff0c\u53ef\u4ee5\u5220\u9664\u6389\u3002"),(0,a.kt)("p",null,"\u540e\u9762\u914d\u7f6e package.json \u7684 typing \u4f1a\u81ea\u52a8\u66f4\u6539\u5b58\u653e\u4f4d\u7f6e"),(0,a.kt)("h3",{id:"\u53c2\u8003-commit-4"},"\u53c2\u8003 commit"),(0,a.kt)("p",null," ",(0,a.kt)("a",{parentName:"p",href:"https://github.com/simonwong/fly-helper/commit/4e4b3df2febf9f32f17e4bb06c3d734508e10b2c"},"4e4b3d")),(0,a.kt)("p",null,"\u4e4b\u540e\u4f7f\u7528\u65b9\u6cd5\u5c31\u6709\u8fd9\u6837\u7684\u63d0\u793a\uff0c\u662f\u4e0d\u662f\u4f1a\u7528\u7684\u5f88\u65b9\u4fbf\u561e\ud83d\ude09"),(0,a.kt)("p",null,(0,a.kt)("img",{parentName:"p",src:"http://file.wangsijie.top/blog/20191226164824.png",alt:null})),(0,a.kt)("h2",{id:"gulp-\u81ea\u52a8\u5316\u6784\u5efa"},"gulp \u81ea\u52a8\u5316\u6784\u5efa"),(0,a.kt)("h3",{id:"\u5b89\u88c5-4"},"\u5b89\u88c5"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-shell"},"yarn add -D gulp @types/gulp fs-extra @types/fs-extra @types/node ts-node chalk\n")),(0,a.kt)("h3",{id:"\u914d\u7f6e-packagejson"},"\u914d\u7f6e package.json"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-json"},'  "main": "lib/index.js",\n  "module": "lib/index.esm.js",\n  "typings": "lib/index.d.js",\n\n  "scripts": {\n      /* ... */\n      "build": "gulp build",\n  }\n')),(0,a.kt)("h3",{id:"\u914d\u7f6e-gulpfile"},"\u914d\u7f6e gulpfile"),(0,a.kt)("p",null,"\u6211\u4eec\u601d\u8003\u4e00\u4e0b\u6784\u5efa\u6d41\u7a0b\ud83e\udd14"),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},"\u5220\u9664 lib \u6587\u4ef6"),(0,a.kt)("li",{parentName:"ol"},"\u547c\u53eb Rollup \u6253\u5305"),(0,a.kt)("li",{parentName:"ol"},"api-extractor \u751f\u6210\u7edf\u4e00\u7684\u58f0\u660e\u6587\u4ef6\uff0c\u7136\u540e \u5220\u9664\u591a\u4f59\u7684\u58f0\u660e\u6587\u4ef6"),(0,a.kt)("li",{parentName:"ol"},"\u5b8c\u6210")),(0,a.kt)("p",null,"\u6211\u4eec\u4e00\u6b65\u4e00\u6b65\u6765"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-typescript"},"// \u5220\u9664 lib \u6587\u4ef6\nconst clearLibFile: TaskFunc = async (cb) => {\n  fse.removeSync(paths.lib)\n  log.progress('Deleted lib file')\n  cb()\n}\n")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-typescript"},"// rollup \u6253\u5305\nconst buildByRollup: TaskFunc = async (cb) => {\n  const inputOptions = {\n    input: rollupConfig.input,\n    external: rollupConfig.external,\n    plugins: rollupConfig.plugins,\n  }\n  const outOptions = rollupConfig.output\n  const bundle = await rollup(inputOptions)\n\n  // \u5199\u5165\u9700\u8981\u904d\u5386\u8f93\u51fa\u914d\u7f6e\n  if (Array.isArray(outOptions)) {\n    outOptions.forEach(async (outOption) => {\n      await bundle.write(outOption)\n    })\n    cb()\n    log.progress('Rollup built successfully')\n  }\n}\n")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-typescript"},"// api-extractor \u6574\u7406 .d.ts \u6587\u4ef6\nconst apiExtractorGenerate: TaskFunc = async (cb) => {\n  const apiExtractorJsonPath: string = path.join(__dirname, './api-extractor.json')\n  // \u52a0\u8f7d\u5e76\u89e3\u6790 api-extractor.json \u6587\u4ef6\n  const extractorConfig: ExtractorConfig = await ExtractorConfig.loadFileAndPrepare(apiExtractorJsonPath)\n  // \u5224\u65ad\u662f\u5426\u5b58\u5728 index.d.ts \u6587\u4ef6\uff0c\u8fd9\u91cc\u5fc5\u987b\u5f02\u6b65\u5148\u8bbf\u95ee\u4e00\u8fb9\uff0c\u4e0d\u7136\u540e\u9762\u627e\u4e0d\u5230\u4f1a\u62a5\u9519\n  const isExist: boolean = await fse.pathExists(extractorConfig.mainEntryPointFilePath)\n\n  if (!isExist) {\n    log.error('API Extractor not find index.d.ts')\n    return\n  }\n\n  // \u8c03\u7528 API\n  const extractorResult: ExtractorResult = await Extractor.invoke(extractorConfig, {\n    localBuild: true,\n    // \u5728\u8f93\u51fa\u4e2d\u663e\u793a\u4fe1\u606f\n    showVerboseMessages: true,\n  })\n\n  if (extractorResult.succeeded) {\n    // \u5220\u9664\u591a\u4f59\u7684 .d.ts \u6587\u4ef6\n    const libFiles: string[] = await fse.readdir(paths.lib)\n    libFiles.forEach(async file => {\n      if (file.endsWith('.d.ts') && !file.includes('index')) {\n        await fse.remove(path.join(paths.lib, file))\n      }\n    })\n    log.progress('API Extractor completed successfully')\n    cb()\n  } else {\n    log.error(`API Extractor completed with ${extractorResult.errorCount} errors`\n      + ` and ${extractorResult.warningCount} warnings`)\n  }\n}\n")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-typescript"},"// \u5b8c\u6210\nconst complete: TaskFunc = (cb) => {\n  log.progress('---- end ----')\n  cb()\n}\n")),(0,a.kt)("p",null,"\u7136\u540e\u7528\u4e00\u4e2a build \u65b9\u6cd5\uff0c\u5c06\u4ed6\u4eec\u6309\u987a\u5e8f\u5408\u8d77\u6765"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-typescript"},"export const build = series(clearLibFile, buildByRollup, apiExtractorGenerate, complete)\n")),(0,a.kt)("h3",{id:"\u5c1d\u8bd5\u4e00\u4e0b-1"},"\u5c1d\u8bd5\u4e00\u4e0b"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-shell"},"yarn build\n")),(0,a.kt)("p",null,"\u6e9c\u53bb lib \u6587\u4ef6\u4e0b\u7785\u7785\ud83e\uddd0\uff0c\u7f8e\u6ecb\u6ecb\u3002"),(0,a.kt)("h3",{id:"\u53c2\u8003-commit-5"},"\u53c2\u8003 commit"),(0,a.kt)("p",null,(0,a.kt)("a",{parentName:"p",href:"https://github.com/simonwong/fly-helper/commit/a5370cb0c1e334d271439916648bc98586b16f05"},"a5370c")),(0,a.kt)("h2",{id:"changelog-\u81ea\u52a8\u751f\u6210"},"changelog \u81ea\u52a8\u751f\u6210"),(0,a.kt)("h3",{id:"\u5b89\u88c5-5"},"\u5b89\u88c5"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-shell"},"yarn add -D conventional-changelog-cli\n")),(0,a.kt)("h3",{id:"\u914d\u7f6e-gulpfile-1"},"\u914d\u7f6e gulpfile"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-typescript"},"// gulpfile\nimport conventionalChangelog from 'conventional-changelog'\n\n// \u81ea\u5b9a\u4e49\u751f\u6210 changelog\nexport const changelog: TaskFunc = async (cb) => {\n  const changelogPath: string = path.join(paths.root, 'CHANGELOG.md')\n  // \u5bf9\u547d\u4ee4 conventional-changelog -p angular -i CHANGELOG.md -w -r 0\n  const changelogPipe = await conventionalChangelog({\n    preset: 'angular',\n    releaseCount: 0,\n  })\n  changelogPipe.setEncoding('utf8')\n\n  const resultArray = ['# \u5de5\u5177\u5e93\u66f4\u65b0\u65e5\u5fd7\\n\\n']\n  changelogPipe.on('data', (chunk) => {\n    // \u539f\u6765\u7684 commits \u8def\u5f84\u662f\u8fdb\u5165\u63d0\u4ea4\u5217\u8868\n    chunk = chunk.replace(/\\/commits\\//g, '/commit/')\n    resultArray.push(chunk)\n  })\n  changelogPipe.on('end', async () => {\n    await fse.createWriteStream(changelogPath).write(resultArray.join(''))\n    cb()\n  })\n}\n\n")),(0,a.kt)("p",null,"\u60ca\u559c\u7684\u53d1\u73b0 conventional-changelog \u6728\u5f97 @types \u5e93\uff0c\u7ee7\u7eed\u624b\u52a8\u6dfb\u52a0"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-typescript"},"// typings/index.d.ts\n\ndeclare module 'conventional-changelog'\n")),(0,a.kt)("h3",{id:"\u53c2\u8003-commit-6"},"\u53c2\u8003 commit"),(0,a.kt)("p",null,(0,a.kt)("a",{parentName:"p",href:"https://github.com/simonwong/fly-helper/commit/1f31ab05ad81e5f726a4b3ee7b73a0c6bf3e8566"},"1f31ab")),(0,a.kt)("h3",{id:"ps-1"},"Ps"),(0,a.kt)("p",null,"\u4f7f\u7528 conventional-changelog \u9700\u8981\u6ce8\u610f\u4e00\u4e0b"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"\u975e\u5e38\u6ce8\u610f commit \u683c\u5f0f\uff0c\u683c\u5f0f\u91c7\u7528 ",(0,a.kt)("a",{parentName:"li",href:"https://github.com/angular/angular/blob/master/CONTRIBUTING.md"},"angular commit \u89c4\u8303"),"\uff0c\u4f1a\u8bc6\u522b feat \u548c fix \u5f00\u5934\u7684 commit \uff0c\u7136\u540e\u81ea\u52a8\u751f\u6210"),(0,a.kt)("li",{parentName:"ul"},"\u6bcf\u6b21\u66f4\u6539\u9700\u8981\u5148\u5347\u7ea7 version \u518d\u53bb\u751f\u6210\u3002\u540e\u9762\u4f1a\u6709\u4f8b\u5b50")),(0,a.kt)("h2",{id:"\u4f18\u5316\u5f00\u53d1\u6d41\u7a0b"},"\u4f18\u5316\u5f00\u53d1\u6d41\u7a0b"),(0,a.kt)("h3",{id:"\u5b89\u88c5-6"},"\u5b89\u88c5"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-shell"},"yarn add -D husky lint-staged\n")),(0,a.kt)("h3",{id:"packagejson"},"package.json"),(0,a.kt)("p",null,"\u8bdd\u4e0d\u591a\u8bf4\uff0c\u770b\u4ee3\u7801"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-json"},'  "husky": {\n    "hooks": {\n      "pre-commit": "lint-staged & jest -u"\n    }\n  },\n  "lint-staged": {\n    "*.{.ts,.js}": [\n      "eslint",\n      "git add"\n    ]\n  }\n')),(0,a.kt)("p",null,"\u4e4b\u540e\u63d0\u4ea4\u4ee3\u7801\u90fd\u4f1a\u5148 lint \u9a8c\u8bc1\uff0c\u518d jest \u6d4b\u8bd5\u901a\u8fc7\uff0c\u624d\u53ef\u4ee5\u63d0\u4ea4\u3002\u89c4\u8303\u56e2\u961f\u534f\u4f5c\u7684\u4ee3\u7801\u89c4\u8303"),(0,a.kt)("h2",{id:"\u4f18\u5316\u53d1\u5e03\u6d41\u7a0b"},"\u4f18\u5316\u53d1\u5e03\u6d41\u7a0b"),(0,a.kt)("h3",{id:"packagejson-1"},"package.json"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-json"},'/* pushlish \u7684\u6587\u4ef6 */\n"files": [\n    "lib",\n    "LICENSE",\n    "CHANGELOG.md",\n    "README.md"\n],\n/* \u4f7f\u5f97\u652f\u6301 tree shaking */\n"sideEffects": "false",\n"script": {\n    /* ... */\n    "changelog": "gulp changelog",\n    "prepublishOnly": "yarn lint & yarn test & yarn changelog & yarn build"\n}\n')),(0,a.kt)("p",null,"prepublishOnly \u53ef\u4ee5\u5728 publish \u7684\u65f6\u5019\uff0c\u5148 lint \u9a8c\u8bc1\uff0c \u518d jest \u6d4b\u8bd5 \uff0c \u518d\u751f\u6210 changlog \uff0c\u6700\u540e\u6253\u5305\uff0c\u6700\u540e\u53d1\u5e03\u3002"),(0,a.kt)("p",null,"\u81f3\u6b64\uff0c\u6211\u4eec\u5df2\u7ecf\u5b9e\u73b0\u4e86\u5168\u90e8\u9700\u6c42\u3002\ud83e\udd73"),(0,a.kt)("h3",{id:"\u53c2\u8003-commit-7"},"\u53c2\u8003 commit"),(0,a.kt)("p",null,(0,a.kt)("a",{parentName:"p",href:"https://github.com/simonwong/fly-helper/commit/7f343fda98ce31bf055184ac60932def8cf81367"},"7f343f")),(0,a.kt)("h2",{id:"changelog-\u4f8b\u5b50"},"changelog \u4f8b\u5b50"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"\u6211\u4eec\u5047\u88c5\u73b0\u5728\u5f00\u59cb\u5199\u7b2c\u4e00\u4e2a\u65b9\u6cd5\u3002\u6211\u5220\u9664\u4e86\u4e0a\u9762\u7684\u4f8b\u5b50\uff0c\u589e\u52a0\u4e86\u4e00\u4e2a calculate.ts"),(0,a.kt)("p",{parentName:"li"},"  \u8bf7\u770b",(0,a.kt)("a",{parentName:"p",href:"https://github.com/simonwong/fly-helper/tree/release/1.0.0"},"\u4ed3\u5e93\u5730\u5740 release/1.0.0 \u5206\u652f"))),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"\u7136\u540e\u6211\u4eec\u63d0\u4ea4\u8fd9\u6b21\u66f4\u6539\uff0ccommit \u5185\u5bb9\u4e3a ",(0,a.kt)("inlineCode",{parentName:"p"},"feat: \u65b0\u589e calculateOneAddOne \u8ba1\u7b97 1 + 1 \u65b9\u6cd5"))),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"\u6267\u884c npm version major \u5347\u7ea7\u4e3b\u7248\u672c\u53f7 1.0.0\u3002"),(0,a.kt)("p",{parentName:"li"},"   ",(0,a.kt)("a",{parentName:"p",href:"https://simonwong.github.io/advanced/npm.html#version"},"\u66f4\u591a\u5347\u7ea7\u7248\u672c\u7684\u64cd\u4f5c")),(0,a.kt)("p",{parentName:"li"},"  \u7248\u672c\u89c4\u8303\u53c2\u8003 ",(0,a.kt)("a",{parentName:"p",href:"https://semver.org/lang/zh-CN/"},"\u8bed\u4e49\u5316\u7248\u672c 2.0.0"))),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},(0,a.kt)("inlineCode",{parentName:"p"},"yarn changelog")," \u770b\u770b\u4f60\u7684 changelog.md \u5c31\u81ea\u52a8\u751f\u6210\u4e86\ud83e\udd73"))),(0,a.kt)("p",null,(0,a.kt)("img",{parentName:"p",src:"http://file.wangsijie.top/blog/20191227100915.png",alt:null})),(0,a.kt)("h3",{id:"\u4ed3\u5e93\u5730\u5740"},"\u4ed3\u5e93\u5730\u5740"),(0,a.kt)("p",null,(0,a.kt)("a",{parentName:"p",href:"https://github.com/simonwong/fly-helper/tree/release/1.0.0"},"fly-helper/release/1.0.0")),(0,a.kt)("h2",{id:"\u53c2\u8003"},"\u53c2\u8003"),(0,a.kt)("p",null,(0,a.kt)("a",{parentName:"p",href:"https://ts.xcatliu.com/"},"TypeScript \u5165\u95e8\u6559\u7a0b")),(0,a.kt)("p",null,(0,a.kt)("a",{parentName:"p",href:"https://microsoft.github.io/TypeSearch/"},"TypeSearch")),(0,a.kt)("p",null,(0,a.kt)("a",{parentName:"p",href:"https://eslint.org/blog/2019/01/future-typescript-eslint"},"The future of TypeScript on ESLint")),(0,a.kt)("p",null,(0,a.kt)("a",{parentName:"p",href:"https://www.rollupjs.com/"},"Rollup.js \u4e2d\u6587\u7f51")),(0,a.kt)("p",null,(0,a.kt)("a",{parentName:"p",href:"https://github.com/rollup/rollup/wiki/pkg.module"},"rollup - pkg.module")),(0,a.kt)("blockquote",null,(0,a.kt)("p",{parentName:"blockquote"},"If you're writing a package, strongly consider using ",(0,a.kt)("inlineCode",{parentName:"p"},"pkg.module"))),(0,a.kt)("p",null,(0,a.kt)("a",{parentName:"p",href:"https://jestjs.io/docs/zh-Hans/getting-started"},"jest \u4e2d\u6587\u6587\u6863")),(0,a.kt)("p",null,(0,a.kt)("a",{parentName:"p",href:"https://api-extractor.com/"},"api-extractor")),(0,a.kt)("p",null,(0,a.kt)("a",{parentName:"p",href:"https://github.com/microsoft/tsdoc"},"tsdoc")),(0,a.kt)("p",null,(0,a.kt)("a",{parentName:"p",href:"https://www.gulpjs.com.cn/docs/getting-started/quick-start/"},"gulp")),(0,a.kt)("p",null,(0,a.kt)("a",{parentName:"p",href:"https://www.ruanyifeng.com/blog/2016/01/commit_message_change_log.html"},"Commit message \u548c Change log \u7f16\u5199\u6307\u5357")))}m.isMDXComponent=!0}}]);