<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>nodejs基础 | 王思杰的前端笔记</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="/logo.png">
    <meta name="description" content="分享日常总结，工具框架的使用以及整理">
    <meta http-equiv="cache-control" content="no-cache">
    
    <link rel="preload" href="/assets/css/0.styles.7352d3e5.css" as="style"><link rel="preload" href="/assets/js/app.b10b90d4.js" as="script"><link rel="preload" href="/assets/js/2.aba2ec75.js" as="script"><link rel="preload" href="/assets/js/20.5f0e92f6.js" as="script"><link rel="preload" href="/assets/js/3.a992b9fe.js" as="script"><link rel="prefetch" href="/assets/js/10.91bf469c.js"><link rel="prefetch" href="/assets/js/100.cff3a47e.js"><link rel="prefetch" href="/assets/js/101.100801aa.js"><link rel="prefetch" href="/assets/js/102.c6dc08b2.js"><link rel="prefetch" href="/assets/js/103.6c050768.js"><link rel="prefetch" href="/assets/js/104.ac189813.js"><link rel="prefetch" href="/assets/js/105.8a76ca38.js"><link rel="prefetch" href="/assets/js/106.86d28331.js"><link rel="prefetch" href="/assets/js/107.e7eb1e6f.js"><link rel="prefetch" href="/assets/js/108.bbbac73a.js"><link rel="prefetch" href="/assets/js/109.7486ed5d.js"><link rel="prefetch" href="/assets/js/11.1f8bf62f.js"><link rel="prefetch" href="/assets/js/110.e7efee71.js"><link rel="prefetch" href="/assets/js/111.a5f5e39f.js"><link rel="prefetch" href="/assets/js/112.320c80f2.js"><link rel="prefetch" href="/assets/js/113.051bcab9.js"><link rel="prefetch" href="/assets/js/114.4cae358f.js"><link rel="prefetch" href="/assets/js/115.8d5a68e5.js"><link rel="prefetch" href="/assets/js/116.92c1b1c1.js"><link rel="prefetch" href="/assets/js/12.2c1e75e2.js"><link rel="prefetch" href="/assets/js/13.659a494d.js"><link rel="prefetch" href="/assets/js/14.e72fb477.js"><link rel="prefetch" href="/assets/js/15.f84f7b47.js"><link rel="prefetch" href="/assets/js/16.d398ce74.js"><link rel="prefetch" href="/assets/js/17.77fab2ad.js"><link rel="prefetch" href="/assets/js/18.14b96c75.js"><link rel="prefetch" href="/assets/js/19.bc97bf97.js"><link rel="prefetch" href="/assets/js/21.68c35422.js"><link rel="prefetch" href="/assets/js/22.b107e40e.js"><link rel="prefetch" href="/assets/js/23.23008d90.js"><link rel="prefetch" href="/assets/js/24.40f731dd.js"><link rel="prefetch" href="/assets/js/25.aaead0e9.js"><link rel="prefetch" href="/assets/js/26.1253f6b0.js"><link rel="prefetch" href="/assets/js/27.13803d3f.js"><link rel="prefetch" href="/assets/js/28.2249e21c.js"><link rel="prefetch" href="/assets/js/29.f495570c.js"><link rel="prefetch" href="/assets/js/30.a0fb088b.js"><link rel="prefetch" href="/assets/js/31.7c3476ae.js"><link rel="prefetch" href="/assets/js/32.2691283d.js"><link rel="prefetch" href="/assets/js/33.adbffdbd.js"><link rel="prefetch" href="/assets/js/34.1e39158e.js"><link rel="prefetch" href="/assets/js/35.edfc3d3e.js"><link rel="prefetch" href="/assets/js/36.80669852.js"><link rel="prefetch" href="/assets/js/37.ece2b30d.js"><link rel="prefetch" href="/assets/js/38.c645f28e.js"><link rel="prefetch" href="/assets/js/39.8f8a1b8c.js"><link rel="prefetch" href="/assets/js/4.45d09f32.js"><link rel="prefetch" href="/assets/js/40.d423e0d6.js"><link rel="prefetch" href="/assets/js/41.ace646da.js"><link rel="prefetch" href="/assets/js/42.d14b4120.js"><link rel="prefetch" href="/assets/js/43.d0b9ff26.js"><link rel="prefetch" href="/assets/js/44.5024b2e5.js"><link rel="prefetch" href="/assets/js/45.6a82c535.js"><link rel="prefetch" href="/assets/js/46.779ea6cb.js"><link rel="prefetch" href="/assets/js/47.5f7f05b0.js"><link rel="prefetch" href="/assets/js/48.a0acf725.js"><link rel="prefetch" href="/assets/js/49.b5c33505.js"><link rel="prefetch" href="/assets/js/5.f3c9e357.js"><link rel="prefetch" href="/assets/js/50.2931e2ab.js"><link rel="prefetch" href="/assets/js/51.0f5070d6.js"><link rel="prefetch" href="/assets/js/52.e69b14d5.js"><link rel="prefetch" href="/assets/js/53.a4e727ca.js"><link rel="prefetch" href="/assets/js/54.3993d045.js"><link rel="prefetch" href="/assets/js/55.215c51d5.js"><link rel="prefetch" href="/assets/js/56.6a8bb769.js"><link rel="prefetch" href="/assets/js/57.06b1273c.js"><link rel="prefetch" href="/assets/js/58.5edb4108.js"><link rel="prefetch" href="/assets/js/59.0d4aa606.js"><link rel="prefetch" href="/assets/js/6.a6c6c2e5.js"><link rel="prefetch" href="/assets/js/60.b94ee0d3.js"><link rel="prefetch" href="/assets/js/61.9536da47.js"><link rel="prefetch" href="/assets/js/62.d16d98c7.js"><link rel="prefetch" href="/assets/js/63.d7f18967.js"><link rel="prefetch" href="/assets/js/64.04912a97.js"><link rel="prefetch" href="/assets/js/65.c469e7ff.js"><link rel="prefetch" href="/assets/js/66.d912c1c1.js"><link rel="prefetch" href="/assets/js/67.e662faf6.js"><link rel="prefetch" href="/assets/js/68.584676ee.js"><link rel="prefetch" href="/assets/js/69.f9d1023f.js"><link rel="prefetch" href="/assets/js/7.937a30f1.js"><link rel="prefetch" href="/assets/js/70.892b87dd.js"><link rel="prefetch" href="/assets/js/71.32cd024e.js"><link rel="prefetch" href="/assets/js/72.b092d8d6.js"><link rel="prefetch" href="/assets/js/73.25c1d80f.js"><link rel="prefetch" href="/assets/js/74.8f9268df.js"><link rel="prefetch" href="/assets/js/75.62cf6721.js"><link rel="prefetch" href="/assets/js/76.e320ecf7.js"><link rel="prefetch" href="/assets/js/77.ad68baed.js"><link rel="prefetch" href="/assets/js/78.d8bff19d.js"><link rel="prefetch" href="/assets/js/79.e8522410.js"><link rel="prefetch" href="/assets/js/8.89804910.js"><link rel="prefetch" href="/assets/js/80.0abc5f87.js"><link rel="prefetch" href="/assets/js/81.dfe2cad8.js"><link rel="prefetch" href="/assets/js/82.305b6f50.js"><link rel="prefetch" href="/assets/js/83.98f0cdfc.js"><link rel="prefetch" href="/assets/js/84.4b1ac88e.js"><link rel="prefetch" href="/assets/js/85.f7567b7b.js"><link rel="prefetch" href="/assets/js/86.637ea658.js"><link rel="prefetch" href="/assets/js/87.ad0859f7.js"><link rel="prefetch" href="/assets/js/88.188b07fc.js"><link rel="prefetch" href="/assets/js/89.32a5f1a9.js"><link rel="prefetch" href="/assets/js/9.0cd8aeb4.js"><link rel="prefetch" href="/assets/js/90.03321550.js"><link rel="prefetch" href="/assets/js/91.9355456d.js"><link rel="prefetch" href="/assets/js/92.56996d3b.js"><link rel="prefetch" href="/assets/js/93.8741417d.js"><link rel="prefetch" href="/assets/js/94.61193ccb.js"><link rel="prefetch" href="/assets/js/95.f8bc9781.js"><link rel="prefetch" href="/assets/js/96.550ed2bd.js"><link rel="prefetch" href="/assets/js/97.781c9b6b.js"><link rel="prefetch" href="/assets/js/98.3865a259.js"><link rel="prefetch" href="/assets/js/99.ea1633c6.js">
    <link rel="stylesheet" href="/assets/css/0.styles.7352d3e5.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">王思杰的前端笔记</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/note/" class="nav-link">
  日常笔记
</a></div><div class="nav-item"><a href="/advanced/" class="nav-link">
  前端进阶
</a></div><div class="nav-item"><a href="/backend/" class="nav-link router-link-active">
  后端
</a></div><div class="nav-item"><a href="/services/" class="nav-link">
  服务器
</a></div><div class="nav-item"><a href="/computerbasic/" class="nav-link">
  计算机基础
</a></div><div class="nav-item"><a href="/tools/" class="nav-link">
  工具
</a></div><div class="nav-item"><a href="/share/" class="nav-link">
  杂乱/分享
</a></div><div class="nav-item"><a href="https://github.com/simonwong" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/note/" class="nav-link">
  日常笔记
</a></div><div class="nav-item"><a href="/advanced/" class="nav-link">
  前端进阶
</a></div><div class="nav-item"><a href="/backend/" class="nav-link router-link-active">
  后端
</a></div><div class="nav-item"><a href="/services/" class="nav-link">
  服务器
</a></div><div class="nav-item"><a href="/computerbasic/" class="nav-link">
  计算机基础
</a></div><div class="nav-item"><a href="/tools/" class="nav-link">
  工具
</a></div><div class="nav-item"><a href="/share/" class="nav-link">
  杂乱/分享
</a></div><div class="nav-item"><a href="https://github.com/simonwong" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/backend/" aria-current="page" class="sidebar-link">后端</a></li><li><a href="/backend/node基础.html" class="active sidebar-link">nodejs基础</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/backend/node基础.html#模块" class="sidebar-link">模块</a></li><li class="sidebar-sub-header"><a href="/backend/node基础.html#require、exports、module" class="sidebar-link">require、exports、module</a></li><li class="sidebar-sub-header"><a href="/backend/node基础.html#包-package" class="sidebar-link">包(package)</a></li><li class="sidebar-sub-header"><a href="/backend/node基础.html#工程目录" class="sidebar-link">工程目录</a></li><li class="sidebar-sub-header"><a href="/backend/node基础.html#npm" class="sidebar-link">NPM</a></li><li class="sidebar-sub-header"><a href="/backend/node基础.html#文件操作" class="sidebar-link">文件操作</a></li><li class="sidebar-sub-header"><a href="/backend/node基础.html#buffer-数据块" class="sidebar-link">Buffer（数据块）</a></li><li class="sidebar-sub-header"><a href="/backend/node基础.html#网络管理" class="sidebar-link">网络管理</a></li><li class="sidebar-sub-header"><a href="/backend/node基础.html#进程管理" class="sidebar-link">进程管理</a></li><li class="sidebar-sub-header"><a href="/backend/node基础.html#异步编程" class="sidebar-link">异步编程</a></li></ul></li><li><a href="/backend/服务性能调优.html" class="sidebar-link">服务性能调优</a></li><li><a href="/backend/mongodb.html" class="sidebar-link">mongodb 操作指令</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="nodejs基础"><a href="#nodejs基础" class="header-anchor">#</a> nodejs基础</h1> <h2 id="模块"><a href="#模块" class="header-anchor">#</a> 模块</h2> <h2 id="require、exports、module"><a href="#require、exports、module" class="header-anchor">#</a> require、exports、module</h2> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// 模块的js中</span>
<span class="token keyword">function</span> <span class="token function">fn</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token comment">// ...</span>
<span class="token punctuation">}</span>
exports<span class="token punctuation">.</span>fn <span class="token operator">=</span> fn<span class="token punctuation">;</span>

<span class="token comment">// 使用module，模块中的js</span>
<span class="token comment">// 用于替换当前模板的导出对象</span>
module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token comment">// ...</span>
<span class="token punctuation">}</span>

<span class="token comment">// 引用模块</span>
<span class="token keyword">const</span> fn <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;./util/fn&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

fn<span class="token punctuation">.</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="包-package"><a href="#包-package" class="header-anchor">#</a> 包(package)</h2> <div class="language- extra-class"><pre class="language-text"><code>- lib/
	- cat/
		+ doc/
		- lib/
			head.js
			body.js
			main.js
		+ tests/
		package.json

/* package.json的内容 */

{
	&quot;name&quot;: &quot;cat&quot;,
	&quot;main&quot;: &quot;./lib/main.js&quot;
}
</code></pre></div><h2 id="工程目录"><a href="#工程目录" class="header-anchor">#</a> 工程目录</h2> <div class="language- extra-class"><pre class="language-text"><code>- /workspace/node-echo	 # 工程目录
	- bin/               # 存放命令行相关代码
		node-echo
	+ doc/               # 存放文档
	- lib/               # 存放API相关文档
		echo.js
	- node_modules/      # 存放三方包
		+ arbv/
	+ tests              # 存放测试用例
	package.json         # 元数据文件
	README.md            # 说明文件
</code></pre></div><h2 id="npm"><a href="#npm" class="header-anchor">#</a> NPM</h2> <blockquote><p>可以用过<a href="https://npmjs.org/" target="_blank" rel="noopener noreferrer">npmjs<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>搜索包</p></blockquote> <blockquote><p>在包名后面加<code>@&lt;version&gt;</code>下载指定版本</p></blockquote> <p>也可以用package.json管理包</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token punctuation">{</span>
	<span class="token string">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;node-echo&quot;</span><span class="token punctuation">,</span>
	<span class="token string">&quot;main&quot;</span><span class="token operator">:</span> <span class="token string">&quot;./lib/echo.js&quot;</span><span class="token punctuation">,</span>
	<span class="token string">&quot;dependencies&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
		<span class="token string">&quot;arvg&quot;</span><span class="token operator">:</span> <span class="token string">&quot;0.02&quot;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="机灵点"><a href="#机灵点" class="header-anchor">#</a> 机灵点</h3> <blockquote><p><a href="https://npmjs.org/doc/" target="_blank" rel="noopener noreferrer">npm官方文档<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></blockquote> <ul><li><code>install</code> <code>publish</code>，使用<code>npm help</code>查看所有命令</li> <li><code>npm install &lt;command&gt;</code>查看某条命令详细帮助</li> <li><code>npm update &lt;package&gt;</code>更新模块</li> <li><code>npm update &lt;package&gt; -g</code>全局安装的，更新</li> <li><code>npm cache clear</code> 清空NPM本地缓存</li> <li><code>npm unpublish &lt;pachage&gt;@&lt;version&gt;</code></li> <li>。。。。</li></ul> <h2 id="文件操作"><a href="#文件操作" class="header-anchor">#</a> 文件操作</h2> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// 小文件拷贝</span>
<span class="token keyword">var</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">copy</span> <span class="token punctuation">(</span><span class="token parameter">src<span class="token punctuation">,</span> dst</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	fs<span class="token punctuation">.</span><span class="token function">writeFileSync</span><span class="token punctuation">(</span>dst<span class="token punctuation">,</span> fs<span class="token punctuation">.</span><span class="token function">readFileSync</span><span class="token punctuation">(</span>src<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">main</span> <span class="token punctuation">(</span><span class="token parameter">argv</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token function">copy</span><span class="token punctuation">(</span>arvg<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> arvg<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token function">main</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span>argv<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ul><li><code>fs.readFileSync</code>从源路径读取文件内容</li> <li><code>fs.writeFileSync</code>讲文件内容写入目标路径</li></ul> <blockquote><p>process是一个全局变量，可以通过<code>process.argv</code>获得命令行参数。
<code>argv[0]</code>固定等于Nodejs执行程序的绝对路径
<code>argv[1]</code>固定等于主模块的绝对路径
所以第一个命令行参数从<code>arvg[2]</code>开始</p></blockquote> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">copy</span> <span class="token punctuation">(</span><span class="token parameter">src<span class="token punctuation">,</span> dst</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	fs<span class="token punctuation">.</span><span class="token function">createReadStream</span><span class="token punctuation">(</span>src<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>fs<span class="token punctuation">.</span><span class="token function">createWriteStream</span><span class="token punctuation">(</span>dst<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// ...</span>
</code></pre></div><ul><li><code>fs.createReadStream</code>创建源文件的只读流</li> <li><code>fs.createWriteStream</code>创建目标文件的只写流</li> <li><code>pipe</code>方法连接</li></ul> <h3 id="api概览"><a href="#api概览" class="header-anchor">#</a> API概览</h3> <h2 id="buffer-数据块"><a href="#buffer-数据块" class="header-anchor">#</a> Buffer（数据块）</h2> <blockquote><p><a href="http://nodejs.cn/api/buffer.html" target="_blank" rel="noopener noreferrer">官方文档<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></blockquote> <p>nodejs提供了一个与<code>String</code>对等的全局构造函数<code>Buffer</code>来提供对二进制数据的操作。
直接构造</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> bin <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Buffer</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0x68</span><span class="token punctuation">,</span> <span class="token number">0x65</span><span class="token punctuation">,</span> <span class="token number">0x6c</span><span class="token punctuation">,</span> <span class="token number">0x6c</span><span class="token punctuation">,</span> ox6f<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>可以使用.length属性，还可以使用[index]读取指定位置的字节。
可以互相转化</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> str <span class="token operator">=</span> bin<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &quot;hello&quot;</span>

<span class="token keyword">var</span> bin <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Buffer</span><span class="token punctuation">(</span><span class="token string">'hello'</span><span class="token punctuation">,</span> <span class="token string">'utf-8'</span><span class="token punctuation">)</span> <span class="token comment">// &lt;Buffer 68 65 6c 6c 6f&gt;</span>
</code></pre></div><blockquote><p>Buffer与字符串的重要区别是字符串是只读的，修改得到新的字符串。
Buffer可以用[index]直接修改某个位置的字节</p></blockquote> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// 想要拷贝Buffer</span>

<span class="token keyword">var</span> bin <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Buffer</span><span class="token punctuation">(</span><span class="token punctuation">[</span> <span class="token number">0x68</span><span class="token punctuation">,</span> <span class="token number">0x65</span><span class="token punctuation">,</span> <span class="token number">0x6c</span><span class="token punctuation">,</span> <span class="token number">0x6c</span><span class="token punctuation">,</span> <span class="token number">0x6f</span> <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> dup <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Buffer</span><span class="token punctuation">(</span>bin<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span>

bin<span class="token punctuation">.</span><span class="token function">copy</span><span class="token punctuation">(</span>dup<span class="token punctuation">)</span><span class="token punctuation">;</span>
dup<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0x48</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>bin<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &lt;Buffer 68 65 6c 6c 6f&gt;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>dup<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &lt;Buffer 48 65 6c 6c 6f&gt;</span>
</code></pre></div><h3 id="stream-数据流"><a href="#stream-数据流" class="header-anchor">#</a> Stream（数据流）</h3> <blockquote><p><a href="http://nodejs.cn/api/stream.html" target="_blank" rel="noopener noreferrer">官方文档<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></blockquote> <blockquote><p>从只读数据流到只写数据流的搬运要注意放爆仓控制。
直接使用<code>.pipe</code></p></blockquote> <h3 id="file-system-文件系统"><a href="#file-system-文件系统" class="header-anchor">#</a> File System （文件系统）</h3> <blockquote><p><a href="http://nodejs.cn/api/fs.html" target="_blank" rel="noopener noreferrer">官方文档<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></blockquote> <blockquote><p><code>fs</code>内置模块提供对文件的操作。API基本分为以下三类</p></blockquote> <ul><li><p>文件属性读写
常用的<code>fs.stat</code> <code>fs.chmod</code> <code>fs.chown</code>等</p></li> <li><p>文件内容读写
常用的<code>fs.readFile</code> <code>fs.readdir</code> <code>fs.writeFile</code> <code>fs.mkdir</code>等等</p></li> <li><p>底层文件操作
常用的<code>fs.open</code> <code>fs.read</code> <code>fs.write</code> <code>fs.close</code> 等等</p></li></ul> <p><code>fs</code>模块API的回调参数都用两个。第一个是有错误发生时等于异常。第二个始终是返回API执行结果</p> <p>所有异步API都有同步版本。方法名末尾多了<code>Sync</code></p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// 异步。两个参数</span>
fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span>pathe<span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token comment">//...</span>
	<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
		<span class="token comment">//...</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// 同步版本</span>
<span class="token keyword">try</span> <span class="token punctuation">{</span>
	<span class="token keyword">var</span> data <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">readFileSync</span><span class="token punctuation">(</span>pathname<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">//...</span>
<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token comment">// ...</span>
<span class="token punctuation">}</span>

</code></pre></div><h3 id="path-路径"><a href="#path-路径" class="header-anchor">#</a> Path （路径）</h3> <blockquote><p><a href="http://nodejs.cn/api/path.html" target="_blank" rel="noopener noreferrer">官方文档<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></blockquote> <p>常用的API</p> <ul><li><code>path.normalize</code></li></ul> <blockquote><p>传入路径转换为标准路径。可以解析<code>.</code> <code>..</code>，还嫩去掉多余的斜杠。</p></blockquote> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> cache <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">store</span> <span class="token punctuation">(</span><span class="token parameter">key<span class="token punctuation">,</span> value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	cache<span class="token punctuation">[</span>path<span class="token punctuation">.</span><span class="token function">normalize</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">]</span> <span class="token operator">=</span> value<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token function">store</span><span class="token punctuation">(</span><span class="token string">'foo/bar'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">store</span><span class="token punctuation">(</span><span class="token string">'foo//baz//..//bar'</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>cache<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// { &quot;foo/bar&quot;: 2 }</span>
</code></pre></div><blockquote><p>坑！！！！
windows系统下路径是<code>\</code>，Linux系统下是<code>/</code>。如果保证任何系统都用<code>/</code>为路径，需要用<code>.replace(/\\/g, '/')</code>。再替换一下标准路径</p></blockquote> <ul><li><code>path.join</code></li></ul> <blockquote><p>将传入的多个路径拼接为标准化路径。</p></blockquote> <div class="language-javascript extra-class"><pre class="language-javascript"><code>path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">'foo/'</span><span class="token punctuation">,</span> <span class="token string">'baz/'</span><span class="token punctuation">,</span> <span class="token string">'../bar'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// =&gt; &quot;foo/bar&quot;</span>
</code></pre></div><ul><li><code>path.extname</code></li></ul> <blockquote><p>拓展名</p></blockquote> <div class="language-javascript extra-class"><pre class="language-javascript"><code>path<span class="token punctuation">.</span><span class="token function">extname</span><span class="token punctuation">(</span><span class="token string">'foo/bar.js'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// =&gt; &quot;.js&quot;</span>
</code></pre></div><h3 id="遍历目录"><a href="#遍历目录" class="header-anchor">#</a> 遍历目录</h3> <ul><li>递归算法</li></ul> <blockquote><p>递归算法虽然简洁，但是重复调用函数影响性能。需要时转换成循环算法</p></blockquote> <ul><li>遍历算法</li></ul> <blockquote><p>深度优先 + 先序遍历</p></blockquote> <div class="language- extra-class"><pre class="language-text"><code>      A
    /   \
   B     C
  / \     \
 D   E     F
A &gt; B &gt; D &gt; E &gt; c &gt; F
</code></pre></div><ul><li>同步遍历</li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">travel</span> <span class="token punctuation">(</span><span class="token parameter">dir<span class="token punctuation">,</span> callback</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	fs<span class="token punctuation">.</span><span class="token function">readdirSync</span><span class="token punctuation">(</span>dir<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">file</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">var</span> pathname <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>dir<span class="token punctuation">,</span> file<span class="token punctuation">)</span><span class="token punctuation">;</span>
		
		<span class="token keyword">if</span> <span class="token punctuation">(</span>fs<span class="token punctuation">.</span><span class="token function">statSync</span><span class="token punctuation">(</span>pathname<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isDirectory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token function">travel</span><span class="token punctuation">(</span>pathname<span class="token punctuation">,</span> callback<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
			<span class="token function">callback</span><span class="token punctuation">(</span>pathname<span class="token punctuation">)</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>异步遍历</li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">travel</span> <span class="token punctuation">(</span><span class="token parameter">dir<span class="token punctuation">,</span> callback</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	fs<span class="token punctuation">.</span><span class="token function">readdir</span><span class="token punctuation">(</span>dir<span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> files</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token function">next</span> <span class="token punctuation">(</span><span class="token parameter">i</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">&lt;</span> files<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span>
				<span class="token keyword">var</span> pathname <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>dir<span class="token punctuation">,</span> files<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

				fs<span class="token punctuation">.</span><span class="token function">stat</span><span class="token punctuation">(</span>pathname<span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> stats</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
					<span class="token keyword">if</span> <span class="token punctuation">(</span>stats<span class="token punctuation">.</span><span class="token function">isDirectory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
						<span class="token function">travel</span><span class="token punctuation">(</span>pathname<span class="token punctuation">.</span> callback<span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
							<span class="token function">next</span><span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
						<span class="token punctuation">}</span><span class="token punctuation">)</span>
					<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
						<span class="token function">callback</span><span class="token punctuation">(</span>pathname<span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
							<span class="token function">next</span><span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span>；
						<span class="token punctuation">}</span><span class="token punctuation">)</span>
					<span class="token punctuation">}</span>
				<span class="token punctuation">}</span><span class="token punctuation">)</span>；
			<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
				finish <span class="token operator">&amp;&amp;</span> <span class="token function">finish</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="文本编码"><a href="#文本编码" class="header-anchor">#</a> 文本编码</h3> <ul><li>BOM的移除</li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">readText</span> <span class="token punctuation">(</span><span class="token parameter">pathname</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">var</span> bin <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">readFileSync</span><span class="token punctuation">(</span>pathname<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">if</span> <span class="token punctuation">(</span>bin<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token number">0xEF</span> <span class="token operator">&amp;&amp;</span> bin<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token number">0xBB</span> <span class="token operator">&amp;&amp;</span> bin<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token number">0xEF</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		bin <span class="token operator">=</span> bin<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>GKB转UTF-8</li></ul> <blockquote><p>GBK编码不在nodejs自身支持范围之内用<code>iconv-lite</code>转换</p></blockquote> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> iconv <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'iconv-lite'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">readGBKText</span> <span class="token punctuation">(</span><span class="token parameter">pathname</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">var</span> bin <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">readFileSync</span><span class="token punctuation">(</span>pathname<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">return</span> iconv<span class="token punctuation">.</span><span class="token function">decode</span><span class="token punctuation">(</span>bin<span class="token punctuation">,</span> <span class="token string">'gbk'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>单字节编码</li></ul> <blockquote><p>一个文件只包含英文字符，无论是GBK还是UTF-8读取都是没问题。问题在于中文字符
除了注释和字符串外，的代码用单字节编码读取。
管不管大于0xEF的单字节被解析成什么，保存好后，对应的字节保持不变
nodejs中自带的<code>binary</code>编码来实现这种方法</p></blockquote> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">replace</span> <span class="token punctuation">(</span><span class="token parameter">pathname</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">var</span> str <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">readFileSync</span><span class="token punctuation">(</span>pathname<span class="token punctuation">,</span> <span class="token string">'binary'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	str <span class="token operator">=</span> str<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token string">'foo'</span><span class="token punctuation">,</span> <span class="token string">'bar'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	fs<span class="token punctuation">.</span><span class="token function">writeFileSync</span><span class="token punctuation">(</span>pathname<span class="token punctuation">,</span> str<span class="token punctuation">,</span> <span class="token string">'binary'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="总结"><a href="#总结" class="header-anchor">#</a> 总结</h3> <ul><li>学号文件操作，编写各种程序都不怕</li> <li>不在意性能的话，fs模块的同步API让生活更美好</li> <li>需要对文件读写到字节级别精准，使用fs模块底层操作</li> <li>路径拼接使用path模块</li> <li>目录遍历和文件编码处理，很实用</li></ul> <h2 id="网络管理"><a href="#网络管理" class="header-anchor">#</a> 网络管理</h2> <h3 id="http"><a href="#http" class="header-anchor">#</a> HTTP</h3> <blockquote><p><a href="http://nodejs.cn/api/http.html" target="_blank" rel="noopener noreferrer">官方文档<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>
http模块两种使用方式
作为服务端使用，创建一个HTTP服务器，监听HTTP客户端请求并返回响应
作为客户端使用，发起一个HTTP客户端请求，获取服务端响应</p></blockquote> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// 服务端</span>
http<span class="token punctuation">.</span><span class="token function">createServer</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">requset<span class="token punctuation">,</span> response</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	response<span class="token punctuation">.</span><span class="token function">writeHead</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token string">'Content-Type'</span><span class="token operator">:</span> <span class="token string">'text/plain'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	
	request<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'data'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">chunk</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		response<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>chunk<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	request<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'end'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		response<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">8080</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// 客户端</span>
<span class="token keyword">var</span> options <span class="token operator">=</span> <span class="token punctuation">{</span>
	hostname<span class="token operator">:</span> <span class="token string">'www.example.com'</span><span class="token punctuation">,</span>
	port<span class="token operator">:</span> <span class="token string">'8080'</span><span class="token punctuation">,</span>
	path<span class="token operator">:</span> <span class="token string">'/upload'</span><span class="token punctuation">,</span>
	method<span class="token operator">:</span> <span class="token string">'POST'</span><span class="token punctuation">,</span>
	header<span class="token operator">:</span> <span class="token punctuation">{</span>
		<span class="token string">'COntent-Type'</span><span class="token operator">:</span> <span class="token string">'application/x-www/form-urlencoded'</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> requset <span class="token operator">=</span> http<span class="token punctuation">.</span><span class="token function">requset</span><span class="token punctuation">(</span>option<span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

requset<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">'Hello World!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
request<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="https"><a href="#https" class="header-anchor">#</a> HTTPS</h3> <blockquote><p><a href="http://nodejs.cn/api/https.html" target="_blank" rel="noopener noreferrer">官网文档<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>
https模块与http模块极为类似，区别在于https模块需要额外处理SSL证书</p></blockquote> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> options <span class="token operator">=</span> <span class="token punctuation">{</span>
	key<span class="token operator">:</span> fs<span class="token punctuation">.</span><span class="token function">readFileSync</span><span class="token punctuation">(</span><span class="token string">'./ssl/default.key'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
	cert<span class="token operator">:</span> fs<span class="token punctuation">.</span><span class="token function">readFileSync</span><span class="token punctuation">(</span><span class="token string">'./ssl/default.cer'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> server <span class="token operator">=</span> https<span class="token punctuation">.</span><span class="token function">createServer</span><span class="token punctuation">(</span>options<span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">request<span class="token punctuation">,</span> response</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token comment">//...</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="url"><a href="#url" class="header-anchor">#</a> URL</h3> <blockquote><p><a href="http://nodejs.cn/api/url.html" target="_blank" rel="noopener noreferrer">官方文档<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></blockquote> <h3 id="query-string"><a href="#query-string" class="header-anchor">#</a> Query String</h3> <blockquote><p><a href="http://nodejs.cn/api/querystring.html" target="_blank" rel="noopener noreferrer">官方文档<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></blockquote> <blockquote><p>用于实现URL参数字符串和参数对象的转换</p></blockquote> <div class="language-javascript extra-class"><pre class="language-javascript"><code>querystring<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token string">'foo=bar&amp;baz=qux&amp;baz=quux&amp;corge'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//&gt;&gt; { foo: 'bar', baz: ['qux', 'quux'], corge: &quot;&quot; };</span>

querystring<span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span><span class="token comment">/*...*/</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="zlib"><a href="#zlib" class="header-anchor">#</a> Zlib</h3> <blockquote><p><a href="http://nodejs.cn/api/zlib.html" target="_blank" rel="noopener noreferrer">官方文档<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></blockquote> <blockquote><p>提供了数据压缩和解压的功能</p></blockquote> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// zib模块压缩HTTP响应体数据的例子。</span>
http<span class="token punctuation">.</span><span class="token function">createServer</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">request<span class="token punctuation">,</span> response</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">1024</span><span class="token punctuation">;</span>
		data <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span>
	
	<span class="token keyword">while</span> <span class="token punctuation">(</span>i<span class="token operator">--</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		data <span class="token operator">+=</span> <span class="token string">'.'</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token comment">// 判断客户端是够支持gzip</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span>headers<span class="token punctuation">[</span><span class="token string">'accept-encoding'</span><span class="token punctuation">]</span> <span class="token operator">||</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">'gzip'</span><span class="token punctuation">)</span> <span class="token operator">!==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		zlib<span class="token punctuation">.</span><span class="token function">gzip</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			response<span class="token punctuation">.</span><span class="token function">writeHead</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
				<span class="token string">'Content-Type'</span><span class="token operator">:</span> <span class="token string">'text/plain'</span><span class="token punctuation">,</span>
				<span class="token string">'Content-Encoding'</span><span class="token operator">:</span> <span class="token string">'gzip'</span>
			<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			response<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
		response<span class="token punctuation">.</span><span class="token function">writeHead</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
			<span class="token string">'Content-Type'</span><span class="token operator">:</span> <span class="token string">'text/plain'</span>
		<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		response<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">80</span><span class="token punctuation">)</span>
</code></pre></div><div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// zlib模块解压HTTP响应体数据</span>

<span class="token keyword">var</span> options <span class="token operator">=</span> <span class="token punctuation">{</span>
	hostname<span class="token operator">:</span> <span class="token string">'www.example.com'</span><span class="token punctuation">,</span>
	port<span class="token operator">:</span> <span class="token number">80</span><span class="token punctuation">,</span>
	path<span class="token operator">:</span> <span class="token string">'/'</span><span class="token punctuation">,</span>
	method<span class="token operator">:</span> <span class="token string">'GET'</span><span class="token punctuation">,</span>
	header<span class="token operator">:</span> <span class="token punctuation">{</span>
		<span class="token string">'Accept-Encoding'</span><span class="token operator">:</span> <span class="token string">'gzip, deflate'</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

http<span class="token punctuation">.</span><span class="token function">request</span><span class="token punctuation">(</span>options<span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">var</span> body <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

	response<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'data'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">chunk</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		body<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>chunk<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span>

	response<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'end'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		body <span class="token operator">=</span> Buffer<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>body<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token comment">// 判断服务端响应是否使用了gzip</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>response<span class="token punctuation">.</span>headers<span class="token punctuation">[</span><span class="token string">'content-encoding'</span><span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token string">'gzip'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			zlib<span class="token punctuation">.</span><span class="token function">gunzip</span><span class="token punctuation">(</span>body<span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
				console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
			console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="net"><a href="#net" class="header-anchor">#</a> Net</h3> <blockquote><p><a href="http://nodejs.cn/api/net.html" target="_blank" rel="noopener noreferrer">官方文档<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></blockquote> <blockquote><p>用于创建Socket服务器或Socket客户端</p></blockquote> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// 搭建一个不严谨的HTTP服务器。不管收到啥请求，都固定返回相同响应</span>

net<span class="token punctuation">.</span><span class="token function">createServer</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">conn</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	conn<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'data'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		conn<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
			<span class="token string">'HTTP/1.1 200 OK'</span><span class="token punctuation">,</span>
			<span class="token string">'Content-Type: text/plain'</span><span class="token punctuation">,</span>
			<span class="token string">'Content-length: 11'</span><span class="token punctuation">,</span>
			<span class="token string">''</span><span class="token punctuation">,</span>
			<span class="token string">'Hello World'</span>
		<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">'\n'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">80</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// 使用Socket发起HTTP客户端请求</span>

<span class="token keyword">var</span> options <span class="token operator">=</span> <span class="token punctuation">{</span>
	port<span class="token operator">:</span> <span class="token number">80</span><span class="token punctuation">,</span>
	host<span class="token operator">:</span> <span class="token string">'www.example.com'</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> client <span class="token operator">=</span> net<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span>options<span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	client<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
		<span class="token string">'GET / HTTP/1.1'</span><span class="token punctuation">,</span>
		<span class="token string">'User-Agent: curl/7.26.0'</span><span class="token punctuation">,</span>
		<span class="token string">'Host: www.example.com'</span><span class="token punctuation">,</span>
		<span class="token string">'Accept: */*'</span><span class="token punctuation">,</span>
		<span class="token string">''</span><span class="token punctuation">,</span>
		<span class="token string">''</span>
	<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">'\n'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

client<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'data'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	consoel<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	client<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="机灵一点"><a href="#机灵一点" class="header-anchor">#</a> 机灵一点</h3> <blockquote><p>nodejs操作网络，尤其是HTTP请求和响应会遇到一些惊喜</p></blockquote> <ul><li><p>为什么通过<code>headers</code>对象访问到的HTTP请求头或响应头字段不是驼峰的？
规范上是驼峰的。现实残酷，所以nodejs同意转为小写，如<code>headers[content-length]</code></p></li> <li><p>为什么<code>http</code>模块创建的HTTP服务器返回的响应是<code>chunked</code>传输方式
使用<code>.writeHead</code>方法写入响应头后，允许使用<code>.write</code>方法写入任意长度的响应体数据，并使用<code>.end</code>方法结束一个响应。因为响应体长度不确定，所以nodejs自动在响应头里添加了<code>Transfer-Encoding: chunked</code>字段，并采用<code>chunked</code>传输方式。当长度确定，使用<code>.writeHead</code>方法在响应头里加上<code>Content-Length</code>字段,这样就不会自动添加。</p></li> <li><p>为什么使用<code>http</code>模块发起HTTP客户端请求时，有事会发生<code>socket hang up</code>错误
发起客户端请求前需要创建一个客户端。<code>http</code>客户端模块提供了全局的客户端<code>http.globalAgent</code>，可以让我们使用<code>.request</code>和<code>.get</code>方法是不用手动创建客户端。但是全局只允许5个并发socket，过多会报这个错。可以<code>http.globalAgent.maxSockets</code>属性改大。<code>https</code>模块可以通过<code>https.globalAgent.maxSockets</code></p></li></ul> <h3 id="小结"><a href="#小结" class="header-anchor">#</a> 小结</h3> <ul><li><code>http</code>和<code>htps</code>模块支持服务端模式和客户端模式两种</li> <li><code>requset</code> 和 <code>response</code>对象除了用于读写头数据外，都可以当做数据流来操作</li> <li><code>url.parse</code>方法加上<code>requset.url</code>属性是处理HTTP请求时的固定搭配</li> <li>使用<code>zlib</code>模式可以减少使用HTTP协议时的数据传输量</li> <li>通过<code>net</code>模块的Socket服务器与客户端对HTTP协议做底层</li></ul> <h2 id="进程管理"><a href="#进程管理" class="header-anchor">#</a> 进程管理</h2> <blockquote><p>NodeJS可以感知和控制自身进程的运行环境和状态，也可以创建子进程并与其协同工作。</p></blockquote> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> child_process <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'child_process'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> util <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'util'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">copy</span> <span class="token punctuation">(</span><span class="token parameter">source<span class="token punctuation">,</span> target<span class="token punctuation">,</span> callback</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	child_process<span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span>
		util<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">'cp -r %s/* %s'</span><span class="token punctuation">,</span> source<span class="token punctuation">,</span> target<span class="token punctuation">)</span><span class="token punctuation">,</span>
		callback
	<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token function">copy</span><span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">,</span> <span class="token string">'b'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
 <span class="token comment">// ...</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="process"><a href="#process" class="header-anchor">#</a> Process</h3> <blockquote><p><a href="http://nodejs.cn/api/process.html" target="_blank" rel="noopener noreferrer">官方文档<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></blockquote> <blockquote><p>任何一个进程都有启动进程时使用的命令行参数，有标准输入标准输出，有运行权限，有运行环境和运行状态。
可以通过<code>Process</code>感知和控制NodeJS自身进程的方方面面。不是内置模块，而是全局对象</p></blockquote> <h4 id="child-process"><a href="#child-process" class="header-anchor">#</a> Child Process</h4> <blockquote><p><a href="http://nodejs.cn/api/child_process.html" target="_blank" rel="noopener noreferrer">官方文档<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></blockquote> <blockquote><p>可以创建和控制子进程。提供的API最核心的是<code>.spawn</code>，其他API是语法糖</p></blockquote> <h3 id="cluster"><a href="#cluster" class="header-anchor">#</a> Cluster</h3> <blockquote><p><a href="http://nodejs.cn/api/cluster.html" target="_blank" rel="noopener noreferrer">官方文档<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></blockquote> <blockquote><p>是对<code>child_process</code>模块的进一步封装，专用语解决单进程NodeJS Web服务器无法充分利用多核CPU</p></blockquote> <h3 id="应用场景"><a href="#应用场景" class="header-anchor">#</a> 应用场景</h3> <ul><li>如何获取命令行参数
可以通过<code>process.arvg</code>获取命令行参数。但是<code>arvg[0]</code>为执行程序路径，<code>arvg[1]</code>为主模块文件路径。第一个命令行参数从<code>arvg[2]</code>开始。可以这样处理</li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">main</span> <span class="token punctuation">(</span><span class="token parameter">arvg</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token comment">// ...</span>
<span class="token punctuation">}</span>
<span class="token function">main</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span>arvg<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ul><li>如何退出程序
通常一个程序做完事，退出状态为<code>0</code>。或者一个程序运行时发生了异常挂了，这是退出状态不等于<code>0</code>。如果捕获了异常，觉得程序不应该继续运行下去，需要立即退出，并需要把退出状态码设置为指定数字，如<code>1</code></li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">try</span> <span class="token punctuation">{</span>
	<span class="token comment">// ...</span>
<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token comment">// ...</span>
	process<span class="token punctuation">.</span><span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>如何控制输入输出</li></ul> <blockquote><p>NodeJS程序的标准输入流（stdin），一个标准输出流（stdout），一个标准错误流（stderr）。分别对应<code>process.stdin</code>、<code>process.stdout</code>和<code>process.stderr</code>。前一个是只读流，后边两个是只写流</p></blockquote> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">log</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	process<span class="token punctuation">.</span>stdout<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>
		util<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>util<span class="token punctuation">,</span> arguments<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">'\n'</span>
	<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>如何降权</li></ul> <blockquote><p>Linux系统下，程序运行在root权限下存在安全隐患，最好把权限降下来。</p></blockquote> <div class="language-javascript extra-class"><pre class="language-javascript"><code>http<span class="token punctuation">.</span><span class="token function">createServer</span><span class="token punctuation">(</span>callback<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">80</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">var</span> env <span class="token operator">=</span> process<span class="token punctuation">.</span>env<span class="token punctuation">,</span>
		uid <span class="token operator">=</span> <span class="token function">parseInt</span><span class="token punctuation">(</span>env<span class="token punctuation">[</span><span class="token string">'SUDO_UID'</span><span class="token punctuation">]</span> <span class="token operator">||</span> process<span class="token punctuation">.</span><span class="token function">getuid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
		gid <span class="token operator">=</span> <span class="token function">parseInt</span><span class="token punctuation">(</span>env<span class="token punctuation">[</span><span class="token string">'SUDO_GID'</span><span class="token punctuation">]</span> <span class="token operator">||</span> process<span class="token punctuation">.</span><span class="token function">getgid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	process<span class="token punctuation">.</span><span class="token function">setgid</span><span class="token punctuation">(</span>gid<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 必先</span>
	process<span class="token punctuation">.</span><span class="token function">setuid</span><span class="token punctuation">(</span>uid<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 否则就没权限改gid了</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><ul><li>如何创建子进程</li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> child <span class="token operator">=</span> child_process<span class="token punctuation">.</span><span class="token function">spawn</span><span class="token punctuation">(</span><span class="token string">'node'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span> <span class="token string">'xxx.js'</span> <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

child<span class="token punctuation">.</span>stdout<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'data'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'stdout'</span> <span class="token operator">+</span> data<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

child<span class="token punctuation">.</span>stderr<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'data'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'stderr'</span> <span class="token operator">=</span> data<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

child<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'close'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">code</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'child process exited width code '</span> <span class="token operator">+</span> code<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><blockquote><p><code>.spawn(exec, args, options)</code>。方法，支持三个参数。第一个参数，是执行文件路径，相对绝对或path环境变量中的。第二个参数，数组中的每个成员都按顺序对应的一个命令行参数。第三个参数可选，用于配置子进程的执行环境与行为</p></blockquote> <ul><li>进程间如何通信</li></ul> <p>linux系统下。进程之间可以通过信号，互相通信。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// parent.js //</span>
<span class="token keyword">var</span> child <span class="token operator">=</span> child_process<span class="token punctuation">.</span><span class="token function">spawn</span><span class="token punctuation">(</span><span class="token string">'node'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span> <span class="token string">'child.js'</span> <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

child<span class="token punctuation">.</span><span class="token function">kill</span><span class="token punctuation">(</span><span class="token string">'SIGTERM'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// kill本质上是用来给进程发送信号的</span>

<span class="token comment">// child.js //</span>
process<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'SIGTERM'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token function">clearUp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	process<span class="token punctuation">.</span><span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>如果父子进程都是NodeJS进程，可以通过IPC（进程间通讯）双向传递数据。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// parent.js //</span>
<span class="token keyword">var</span> child <span class="token operator">=</span> child_process<span class="token punctuation">.</span><span class="token function">spawn</span><span class="token punctuation">(</span><span class="token string">'node'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span> <span class="token string">'child.js'</span> <span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>
	stdio<span class="token operator">:</span> <span class="token punctuation">[</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">'ipc'</span> <span class="token punctuation">]</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span>
child<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'message'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">msg</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
child<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">{</span> hello<span class="token operator">:</span> <span class="token string">'hello'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// child.js //</span>
process<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'message'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>
	msg<span class="token punctuation">.</span>hello <span class="token operator">=</span> msg<span class="token punctuation">.</span>hello<span class="token punctuation">.</span><span class="token function">toUpperCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	process<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre></div><ul><li>如何守护子进程</li></ul> <blockquote><p>一般用于监控工作进程的运行状态
下例，程序非正常退出时。守护进程立即重启工程。</p></blockquote> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// daemon.js //</span>
<span class="token keyword">function</span> <span class="token function">spawn</span> <span class="token punctuation">(</span><span class="token parameter">mainModule</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">var</span> worker <span class="token operator">=</span> child_process<span class="token punctuation">.</span><span class="token function">spawn</span><span class="token punctuation">(</span><span class="token string">'node'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span> mainModule <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	worker<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'exit'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">code</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>code <span class="token operator">!==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token function">spawn</span><span class="token punctuation">(</span>mainModule<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token function">spawn</span><span class="token punctuation">(</span><span class="token string">'worker.js'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="小结-2"><a href="#小结-2" class="header-anchor">#</a> 小结</h3> <ul><li>使用<code>process</code>对象管理自身</li> <li>使用<code>child_process</code>模块创建和管理子进程</li></ul> <h2 id="异步编程"><a href="#异步编程" class="header-anchor">#</a> 异步编程</h2> <blockquote><p>NodeJS最大的卖点---事件机制和异步IO</p></blockquote> <h3 id="回调"><a href="#回调" class="header-anchor">#</a> 回调</h3> <blockquote><p>异步编程依托于回调来时实现。但不能说使用了回调程序就是异步化了
JS是单线程运行的。这决定了JS在执行一段代码之前，无法执行包含回调函数在内的别的代码</p></blockquote> <h3 id="代码设计模式"><a href="#代码设计模式" class="header-anchor">#</a> 代码设计模式</h3> <ul><li>函数返回值</li></ul> <blockquote><p>使一个函数的输出作为另一个函数的输入是常见的需求。</p></blockquote> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// 同步</span>
<span class="token keyword">var</span> output <span class="token operator">=</span> <span class="token function">fn_1</span><span class="token punctuation">(</span><span class="token function">fn_2</span><span class="token punctuation">(</span><span class="token string">'input'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// DO...</span>

<span class="token comment">// 异步</span>
<span class="token function">fn_2</span><span class="token punctuation">(</span><span class="token string">'input'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">output2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token function">fn_1</span><span class="token punctuation">(</span>output2<span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">output</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token comment">// DO...</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><ul><li>遍历数组</li></ul> <blockquote><p>遍历数组，对数据成员做处理</p></blockquote> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// 同步</span>
<span class="token keyword">var</span> len <span class="token operator">=</span> arr<span class="token punctuation">.</span>length<span class="token punctuation">,</span>
	i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> len<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">sync</span><span class="token punctuation">(</span>arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// all array items have processed</span>

<span class="token comment">// 异步</span>
<span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token parameter">i<span class="token punctuation">,</span> len<span class="token punctuation">,</span> callback</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">&lt;</span> len<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">async</span><span class="token punctuation">(</span>arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> value<span class="token punctuation">;</span>
			<span class="token function">next</span><span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> len<span class="token punctuation">,</span> callback<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
		<span class="token function">callback</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> arr<span class="token punctuation">.</span>length<span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token comment">// processed on here</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><ul><li>异常处理</li></ul> <blockquote><p>js自身提供的异常捕获和处理机制。<code>try..catch..</code>只能用于同步执行的代码。</p></blockquote> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">sync</span> <span class="token punctuation">(</span><span class="token parameter">fn</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">return</span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">try</span> <span class="token punctuation">{</span>
	<span class="token function">sync</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">// Do Something</span>
<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Error: %s&quot;</span><span class="token punctuation">,</span> err<span class="token punctuation">.</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><blockquote><p>异常会沿着代码执行路径一直冒泡。直到遇到<code>try</code>语句时被捕获住。
由于异步函数会打断代码执行路径。直到被打断没有遇到<code>try</code>时，就作为全局异常抛出
因为路径被打断， 需要在异常冒泡到断点前用<code>try</code>语句把异常捕获，并通过回调函数传递异常</p></blockquote> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">fn<span class="token punctuation">,</span> callback</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">try</span> <span class="token punctuation">{</span>
			<span class="token function">callback</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token function">callback</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">async</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Error %s'</span><span class="token punctuation">,</span> err<span class="token punctuation">.</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
		<span class="token comment">// Do somethinf...</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><blockquote><p>如果有许多个异步函数调用，就会非常复杂</p></blockquote> <h3 id="域-domain"><a href="#域-domain" class="header-anchor">#</a> 域（Domain）</h3> <blockquote><p><a href="http://nodejs.cn/api/domain.html" target="_blank" rel="noopener noreferrer">官方文档<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></blockquote> <blockquote><p>域模块可以简化异步代码的异常处理。
一个域就是一个js运行环境。如果一个异常没有捕获就会作为全局异常抛出。通过process对象提供了捕获全局异常的方法</p></blockquote> <div class="language-javascript extra-class"><pre class="language-javascript"><code>process<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'uncaughtException'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'error %s'</span><span class="token punctuation">,</span> err<span class="token punctuation">.</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">fn</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>。
。
。
。</p> <h3 id="小结-3"><a href="#小结-3" class="header-anchor">#</a> 小结</h3> <ul><li>不掌握异步编程不算学会NodeJS。</li> <li>异步编程依托回调实现，而使用回调不一定就是异步编程</li> <li>异步编程下的函数间数据传递，数组遍历，和异常处理与同步编程有很大差别</li> <li>使用<code>domian</code>模块简化异步代码的异常处理</li></ul></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">2 年前</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/backend/" class="prev router-link-active">
        后端
      </a></span> <span class="next"><a href="/backend/服务性能调优.html">
        服务性能调优
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----><!----></div></div>
    <script src="/assets/js/app.b10b90d4.js" defer></script><script src="/assets/js/2.aba2ec75.js" defer></script><script src="/assets/js/20.5f0e92f6.js" defer></script><script src="/assets/js/3.a992b9fe.js" defer></script>
  </body>
</html>
